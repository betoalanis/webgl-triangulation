var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(l,w,t){l!=Array.prototype&&l!=Object.prototype&&(l[w]=t.value)};$jscomp.getGlobal=function(l){return"undefined"!=typeof window&&window===l?l:"undefined"!=typeof global&&null!=global?global:l};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(l,w,t,k){if(w){t=$jscomp.global;l=l.split(".");for(k=0;k<l.length-1;k++){var e=l[k];e in t||(t[e]={});t=t[e]}l=l[l.length-1];k=t[l];w=w(k);w!=k&&null!=w&&$jscomp.defineProperty(t,l,{configurable:!0,writable:!0,value:w})}};$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;
$jscomp.Symbol=function(l){return $jscomp.SYMBOL_PREFIX+(l||"")+$jscomp.symbolCounter_++};$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var l=$jscomp.global.Symbol.iterator;l||(l=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[l]&&$jscomp.defineProperty(Array.prototype,l,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};
$jscomp.arrayIterator=function(l){var w=0;return $jscomp.iteratorPrototype(function(){return w<l.length?{done:!1,value:l[w++]}:{done:!0}})};$jscomp.iteratorPrototype=function(l){$jscomp.initSymbolIterator();l={next:l};l[$jscomp.global.Symbol.iterator]=function(){return this};return l};
$jscomp.iteratorFromArray=function(l,w){$jscomp.initSymbolIterator();l instanceof String&&(l+="");var t=0,k={next:function(){if(t<l.length){var e=t++;return{value:w(e,l[e]),done:!1}}k.next=function(){return{done:!0,value:void 0}};return k.next()}};k[Symbol.iterator]=function(){return k};return k};$jscomp.polyfill("Array.prototype.entries",function(l){return l?l:function(){return $jscomp.iteratorFromArray(this,function(l,t){return[l,t]})}},"es6-impl","es3");
$jscomp.polyfill("Array.prototype.keys",function(l){return l?l:function(){return $jscomp.iteratorFromArray(this,function(l){return l})}},"es6-impl","es3");$jscomp.findInternal=function(l,w,t){l instanceof String&&(l=String(l));for(var k=l.length,e=0;e<k;e++){var a=l[e];if(w.call(t,a,e,l))return{i:e,v:a}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.find",function(l){return l?l:function(l,t){return $jscomp.findInternal(this,l,t).v}},"es6-impl","es3");
(function e$jscomp$0(w,t,k){function e(g,u){if(!t[g]){if(!w[g]){var n="function"==typeof require&&require;if(!u&&n)return n(g,!0);if(a)return a(g,!0);u=Error("Cannot find module '"+g+"'");throw u.code="MODULE_NOT_FOUND",u;}u=t[g]={exports:{}};w[g][0].call(u.exports,function(a){var q=w[g][1][a];return e(q?q:a)},u,u.exports,e$jscomp$0,w,t,k)}return t[g].exports}for(var a="function"==typeof require&&require,g=0;g<k.length;g++)e(k[g]);return e})({1:[function(l,w,t){function k(a){var g=32;(a&=-a)&&g--;
a&65535&&(g-=16);a&16711935&&(g-=8);a&252645135&&(g-=4);a&858993459&&(g-=2);a&1431655765&&--g;return g}"use restrict";t.INT_BITS=32;t.INT_MAX=2147483647;t.INT_MIN=-2147483648;t.sign=function(a){return(0<a)-(0>a)};t.abs=function(a){var g=a>>31;return(a^g)-g};t.min=function(a,g){return g^(a^g)&-(a<g)};t.max=function(a,g){return a^(a^g)&-(a<g)};t.isPow2=function(a){return!(a&a-1)&&!!a};t.log2=function(a){var g=(65535<a)<<4;a>>>=g;var e=(255<a)<<3;a>>>=e;g|=e;e=(15<a)<<2;a>>>=e;g|=e;e=(3<a)<<1;return g|
e|a>>>e>>1};t.log10=function(a){return 1E9<=a?9:1E8<=a?8:1E7<=a?7:1E6<=a?6:1E5<=a?5:1E4<=a?4:1E3<=a?3:100<=a?2:10<=a?1:0};t.popCount=function(a){a-=a>>>1&1431655765;a=(a&858993459)+(a>>>2&858993459);return 16843009*(a+(a>>>4)&252645135)>>>24};t.countTrailingZeros=k;t.nextPow2=function(a){a+=0===a;--a;a|=a>>>1;a|=a>>>2;a|=a>>>4;a|=a>>>8;return(a|a>>>16)+1};t.prevPow2=function(a){a|=a>>>1;a|=a>>>2;a|=a>>>4;a|=a>>>8;a|=a>>>16;return a-(a>>>1)};t.parity=function(a){a^=a>>>16;a^=a>>>8;return 27030>>>((a^
a>>>4)&15)&1};var e=Array(256);(function(a){for(var g=0;256>g;++g){for(var e=g,k=g,n=7,e=e>>>1;e;e>>>=1)k<<=1,k|=e&1,--n;a[g]=k<<n&255}})(e);t.reverse=function(a){return e[a&255]<<24|e[a>>>8&255]<<16|e[a>>>16&255]<<8|e[a>>>24&255]};t.interleave2=function(a,g){a&=65535;a=(a|a<<8)&16711935;a=(a|a<<4)&252645135;a=(a|a<<2)&858993459;g&=65535;g=(g|g<<8)&16711935;g=(g|g<<4)&252645135;g=(g|g<<2)&858993459;return(a|a<<1)&1431655765|((g|g<<1)&1431655765)<<1};t.deinterleave2=function(a,g){a=a>>>g&1431655765;
a=(a|a>>>1)&858993459;a=(a|a>>>2)&252645135;a=(a|a>>>4)&16711935;return((a|a>>>16)&65535)<<16>>16};t.interleave3=function(a,g,e){a&=1023;a=(a|a<<16)&4278190335;a=(a|a<<8)&251719695;a=(a|a<<4)&3272356035;g&=1023;g=(g|g<<16)&4278190335;g=(g|g<<8)&251719695;g=(g|g<<4)&3272356035;e&=1023;e=(e|e<<16)&4278190335;e=(e|e<<8)&251719695;e=(e|e<<4)&3272356035;return(a|a<<2)&1227133513|((g|g<<2)&1227133513)<<1|((e|e<<2)&1227133513)<<2};t.deinterleave3=function(a,e){a=a>>>e&1227133513;a=(a|a>>>2)&3272356035;a=
(a|a>>>4)&251719695;a=(a|a>>>8)&4278190335;return((a|a>>>16)&1023)<<22>>22};t.nextCombination=function(a){var e=a|a-1;return e+1|(~e&-~e)-1>>>k(a)+1}},{}],2:[function(l,w,t){(function(k,e){"object"===typeof t&&"undefined"!==typeof w?e(t):"function"===typeof define&&define.amd?define(["exports"],e):e(k.d3=k.d3||{})})(this,function(k){function e(){}function a(d,b){var c=new e;if(d instanceof e)d.each(function(d,b){c.set(b,d)});else if(Array.isArray(d)){var a=-1,h=d.length,v;if(null==b)for(;++a<h;)c.set(a,
d[a]);else for(;++a<h;)c.set(b(v=d[a],a,d),v)}else if(d)for(a in d)c.set(a,d[a]);return c}function g(){return{}}function l(d,b,c){d[b]=c}function u(){return a()}function n(d,b,c){d.set(b,c)}function y(){}function q(d,b){var c=new y;if(d instanceof y)d.each(function(d){c.add(d)});else if(d){var a=-1,h=d.length;if(null==b)for(;++a<h;)c.add(d[a]);else for(;++a<h;)c.add(b(d[a],a,d))}return c}e.prototype=a.prototype={constructor:e,has:function(d){return"$"+d in this},get:function(d){return this["$"+d]},
set:function(d,b){this["$"+d]=b;return this},remove:function(d){d="$"+d;return d in this&&delete this[d]},clear:function(){for(var d in this)"$"===d[0]&&delete this[d]},keys:function(){var d=[],b;for(b in this)"$"===b[0]&&d.push(b.slice(1));return d},values:function(){var d=[],b;for(b in this)"$"===b[0]&&d.push(this[b]);return d},entries:function(){var d=[],b;for(b in this)"$"===b[0]&&d.push({key:b.slice(1),value:this[b]});return d},size:function(){var d=0,b;for(b in this)"$"===b[0]&&++d;return d},
empty:function(){for(var d in this)if("$"===d[0])return!1;return!0},each:function(d){for(var b in this)"$"===b[0]&&d(this[b],b.slice(1),this)}};var c=a.prototype;y.prototype=q.prototype={constructor:y,has:c.has,add:function(d){d+="";this["$"+d]=d;return this},remove:c.remove,clear:c.clear,values:c.keys,size:c.size,empty:c.empty,each:c.each};k.nest=function(){function d(b,f,m,e){if(f>=c.length)return null!=v?v(b):null!=h?b.sort(h):b;for(var q=-1,g=b.length,z=c[f++],n,A,k=a(),P,J=m();++q<g;)(P=k.get(n=
z(A=b[q])+""))?P.push(A):k.set(n,[A]);k.each(function(b,c){e(J,c,d(b,f,m,e))});return J}function b(d,h){if(++h>c.length)return d;var a=f[h-1];if(null!=v&&h>=c.length)var m=d.entries();else m=[],d.each(function(d,c){m.push({key:c,values:b(d,h)})});return null!=a?m.sort(function(d,b){return a(d.key,b.key)}):m}var c=[],f=[],h,v,e;return e={object:function(b){return d(b,0,g,l)},map:function(b){return d(b,0,u,n)},entries:function(c){return b(d(c,0,u,n),0)},key:function(b){c.push(b);return e},sortKeys:function(b){f[c.length-
1]=b;return e},sortValues:function(b){h=b;return e},rollup:function(b){v=b;return e}}};k.set=q;k.map=a;k.keys=function(d){var b=[],c;for(c in d)b.push(c);return b};k.values=function(c){var b=[],d;for(d in c)b.push(c[d]);return b};k.entries=function(c){var b=[],d;for(d in c)b.push({key:d,value:c[d]});return b};Object.defineProperty(k,"__esModule",{value:!0})})},{}],3:[function(l,w,t){(function(k,e){"object"===typeof t&&"undefined"!==typeof w?e(t):"function"===typeof define&&define.amd?define(["exports"],
e):e(k.d3=k.d3||{})})(this,function(k){function e(){for(var e=0,g=arguments.length,q={},c;e<g;++e){if(!(c=arguments[e]+"")||c in q)throw Error("illegal type: "+c);q[c]=[]}return new a(q)}function a(a){this._=a}function g(a,e){return a.trim().split(/^|\s+/).map(function(a){var c="",d=a.indexOf(".");0<=d&&(c=a.slice(d+1),a=a.slice(0,d));if(a&&!e.hasOwnProperty(a))throw Error("unknown type: "+a);return{type:a,name:c}})}function l(a,e,g){for(var c=0,d=a.length;c<d;++c)if(a[c].name===e){a[c]=u;a=a.slice(0,
c).concat(a.slice(c+1));break}null!=g&&a.push({name:e,value:g});return a}var u={value:function(){}};a.prototype=e.prototype={constructor:a,on:function(a,e){var q=this._,c=g(a+"",q),d,b=-1,m=c.length;if(2>arguments.length)for(;++b<m;){var f;if(f=d=(a=c[b]).type){a:{f=q[d];for(var h=0,v=f.length;h<v;++h)if((d=f[h]).name===a.name){d=d.value;break a}d=void 0}f=d}if(f)return d}else{if(null!=e&&"function"!==typeof e)throw Error("invalid callback: "+e);for(;++b<m;)if(d=(a=c[b]).type)q[d]=l(q[d],a.name,e);
else if(null==e)for(d in q)q[d]=l(q[d],a.name,null);return this}},copy:function(){var e={},g=this._,q;for(q in g)e[q]=g[q].slice();return new a(e)},call:function(a,e){if(0<(d=arguments.length-2))for(var g=Array(d),c=0,d,b;c<d;++c)g[c]=arguments[c+2];if(!this._.hasOwnProperty(a))throw Error("unknown type: "+a);b=this._[a];c=0;for(d=b.length;c<d;++c)b[c].value.apply(e,g)},apply:function(a,e,g){if(!this._.hasOwnProperty(a))throw Error("unknown type: "+a);a=this._[a];for(var c=0,d=a.length;c<d;++c)a[c].value.apply(e,
g)}};k.dispatch=e;Object.defineProperty(k,"__esModule",{value:!0})})},{}],4:[function(l,w,t){(function(k,e){"object"===typeof t&&"undefined"!==typeof w?e(t,l("d3-quadtree"),l("d3-collection"),l("d3-dispatch"),l("d3-timer")):"function"===typeof define&&define.amd?define(["exports","d3-quadtree","d3-collection","d3-dispatch","d3-timer"],e):e(k.d3=k.d3||{},k.d3,k.d3,k.d3,k.d3)})(this,function(k,e,a,g,l){function u(b){return b.x+b.vx}function n(b){return b.y+b.vy}function y(b){return b.index}function q(b,
c){b=b.get(c);if(!b)throw Error("missing: "+c);return b}function c(b){return b.x}function d(b){return b.y}var b=function(b){return function(){return b}},m=function(){return 1E-6*(Math.random()-.5)},f=Math.PI*(3-Math.sqrt(5));k.forceCenter=function(b,c){function d(){var d,h=a.length,f=0,m=0;for(d=0;d<h;++d){var e=a[d];f+=e.x;m+=e.y}f=f/h-b;m=m/h-c;for(d=0;d<h;++d)e=a[d],e.x-=f,e.y-=m}var a;null==b&&(b=0);null==c&&(c=0);d.initialize=function(b){a=b};d.x=function(c){return arguments.length?(b=+c,d):
b};d.y=function(b){return arguments.length?(c=+b,d):c};return d};k.forceCollide=function(c){function d(){function b(b,c,d,a,h){var f=b.data;b=b.r;var e=J+b;if(f)f.index>v.index&&(c=z-f.x-f.vx,d=A-f.y-f.vy,a=c*c+d*d,a<e*e&&(0===c&&(c=m(),a+=c*c),0===d&&(d=m(),a+=d*d),a=(e-(a=Math.sqrt(a)))/a*q,v.vx+=(c*=a)*(e=(b*=b)/(X+b)),v.vy+=(d*=a)*e,f.vx-=c*(e=1-e),f.vy-=d*e));else return c>z+e||a<z-e||d>A+e||h<A-e}for(var c,d=f.length,h,v,z,A,J,X,P=0;P<k;++P)for(h=e.quadtree(f,u,n).visitAfter(a),c=0;c<d;++c)v=
f[c],J=g[v.index],X=J*J,z=v.x+v.vx,A=v.y+v.vy,h.visit(b)}function a(b){if(b.data)return b.r=g[b.data.index];for(var c=b.r=0;4>c;++c)b[c]&&b[c].r>b.r&&(b.r=b[c].r)}function h(){if(f){var b,d=f.length;g=Array(d);for(b=0;b<d;++b){var a=f[b];g[a.index]=+c(a,b,f)}}}var f,g,q=1,k=1;"function"!==typeof c&&(c=b(null==c?1:+c));d.initialize=function(b){f=b;h()};d.iterations=function(b){return arguments.length?(k=+b,d):k};d.strength=function(b){return arguments.length?(q=+b,d):q};d.radius=function(a){return arguments.length?
(c="function"===typeof a?a:b(+a),h(),d):c};return d};k.forceLink=function(c){function d(b){for(var d=0,a=c.length;d<w;++d)for(var h=0,f,e,v,g,q;h<a;++h)f=c[h],e=f.source,f=f.target,v=f.x+f.vx-e.x-e.vx||m(),g=f.y+f.vy-e.y-e.vy||m(),q=Math.sqrt(v*v+g*g),q=(q-l[h])/q*b*n[h],v*=q,g*=q,f.vx-=v*(q=Q[h]),f.vy-=g*q,e.vx+=v*(q=1-q),e.vy+=g*q}function h(){if(x){var b=x.length,d=c.length,h=a.map(x,g);var m=0;for(t=Array(b);m<d;++m)b=c[m],b.index=m,"object"!==typeof b.source&&(b.source=q(h,b.source)),"object"!==
typeof b.target&&(b.target=q(h,b.target)),t[b.source.index]=(t[b.source.index]||0)+1,t[b.target.index]=(t[b.target.index]||0)+1;m=0;for(Q=Array(d);m<d;++m)b=c[m],Q[m]=t[b.source.index]/(t[b.source.index]+t[b.target.index]);n=Array(d);f();l=Array(d);e()}}function f(){if(x)for(var b=0,d=c.length;b<d;++b)n[b]=+k(c[b],b,c)}function e(){if(x)for(var b=0,d=c.length;b<d;++b)l[b]=+u(c[b],b,c)}var g=y,k=function(b){return 1/Math.min(t[b.source.index],t[b.target.index])},n,u=b(30),l,x,t,Q,w=1;null==c&&(c=[]);
d.initialize=function(b){x=b;h()};d.links=function(b){return arguments.length?(c=b,h(),d):c};d.id=function(b){return arguments.length?(g=b,d):g};d.iterations=function(b){return arguments.length?(w=+b,d):w};d.strength=function(c){return arguments.length?(k="function"===typeof c?c:b(+c),f(),d):k};d.distance=function(c){return arguments.length?(u="function"===typeof c?c:b(+c),e(),d):u};return d};k.forceManyBody=function(){function a(b){var a=k.length,f=e.quadtree(k,c,d).visitAfter(g);u=b;for(b=0;b<a;++b)n=
k[b],f.visit(q)}function f(){if(k){var b,c=k.length;l=Array(c);for(b=0;b<c;++b){var d=k[b];l[d.index]=+X(d,b,k)}}}function g(b){var c=0,d,a,f,h,m;if(b.length){for(f=h=m=0;4>m;++m)(d=b[m])&&(a=d.value)&&(c+=a,f+=a*d.x,h+=a*d.y);b.x=f/c;b.y=h/c}else{d=b;d.x=d.data.x;d.y=d.data.y;do c+=l[d.data.index];while(d=d.next)}b.value=c}function q(b,d,c,a){if(!b.value)return!0;c=b.x-n.x;var f=b.y-n.y;d=a-d;a=c*c+f*f;if(d*d/t<a)return a<y&&(0===c&&(c=m(),a+=c*c),0===f&&(f=m(),a+=f*f),a<x&&(a=Math.sqrt(x*a)),n.vx+=
c*b.value*u/a,n.vy+=f*b.value*u/a),!0;if(!(b.length||a>=y)){if(b.data!==n||b.next)0===c&&(c=m(),a+=c*c),0===f&&(f=m(),a+=f*f),a<x&&(a=Math.sqrt(x*a));do b.data!==n&&(d=l[b.data.index]*u/a,n.vx+=c*d,n.vy+=f*d);while(b=b.next)}}var k,n,u,X=b(-30),l,x=1,y=Infinity,t=.81;a.initialize=function(b){k=b;f()};a.strength=function(c){return arguments.length?(X="function"===typeof c?c:b(+c),f(),a):X};a.distanceMin=function(b){return arguments.length?(x=b*b,a):Math.sqrt(x)};a.distanceMax=function(b){return arguments.length?
(y=b*b,a):Math.sqrt(y)};a.theta=function(b){return arguments.length?(t=b*b,a):Math.sqrt(t)};return a};k.forceSimulation=function(b){function c(){d();w.call("tick",e);q<k&&(t.stop(),w.call("end",e))}function d(){var c,d=b.length;q+=(u-q)*n;y.each(function(b){b(q)});for(c=0;c<d;++c){var a=b[c];null==a.fx?a.x+=a.vx*=x:(a.x=a.fx,a.vx=0);null==a.fy?a.y+=a.vy*=x:(a.y=a.fy,a.vy=0)}}function h(){for(var c=0,d=b.length,a;c<d;++c){a=b[c];a.index=c;if(isNaN(a.x)||isNaN(a.y)){var h=10*Math.sqrt(c),m=c*f;a.x=
h*Math.cos(m);a.y=h*Math.sin(m)}if(isNaN(a.vx)||isNaN(a.vy))a.vx=a.vy=0}}function m(c){c.initialize&&c.initialize(b);return c}var e,q=1,k=.001,n=1-Math.pow(k,1/300),u=0,x=.6,y=a.map(),t=l.timer(c),w=g.dispatch("tick","end");null==b&&(b=[]);h();return e={tick:d,restart:function(){return t.restart(c),e},stop:function(){return t.stop(),e},nodes:function(c){return arguments.length?(b=c,h(),y.each(m),e):b},alpha:function(b){return arguments.length?(q=+b,e):q},alphaMin:function(b){return arguments.length?
(k=+b,e):k},alphaDecay:function(b){return arguments.length?(n=+b,e):+n},alphaTarget:function(b){return arguments.length?(u=+b,e):u},velocityDecay:function(b){return arguments.length?(x=1-b,e):1-x},force:function(b,c){return 1<arguments.length?(null==c?y.remove(b):y.set(b,m(c)),e):y.get(b)},find:function(c,d,a){var f,h=b.length;a=null==a?Infinity:a*a;for(f=0;f<h;++f){var m=b[f];var e=c-m.x;var v=d-m.y;e=e*e+v*v;if(e<a){var g=m;a=e}}return g},on:function(b,c){return 1<arguments.length?(w.on(b,c),e):
w.on(b)}}};k.forceX=function(c){function d(b){for(var c=0,d=h.length,a;c<d;++c)a=h[c],a.vx+=(e[c]-a.x)*m[c]*b}function a(){if(h){var b,d=h.length;m=Array(d);e=Array(d);for(b=0;b<d;++b)m[b]=isNaN(e[b]=+c(h[b],b,h))?0:+f(h[b],b,h)}}var f=b(.1),h,m,e;"function"!==typeof c&&(c=b(null==c?0:+c));d.initialize=function(b){h=b;a()};d.strength=function(c){return arguments.length?(f="function"===typeof c?c:b(+c),a(),d):f};d.x=function(f){return arguments.length?(c="function"===typeof f?f:b(+f),a(),d):c};return d};
k.forceY=function(c){function d(b){for(var c=0,d=h.length,a;c<d;++c)a=h[c],a.vy+=(e[c]-a.y)*m[c]*b}function a(){if(h){var b,d=h.length;m=Array(d);e=Array(d);for(b=0;b<d;++b)m[b]=isNaN(e[b]=+c(h[b],b,h))?0:+f(h[b],b,h)}}var f=b(.1),h,m,e;"function"!==typeof c&&(c=b(null==c?0:+c));d.initialize=function(b){h=b;a()};d.strength=function(c){return arguments.length?(f="function"===typeof c?c:b(+c),a(),d):f};d.y=function(f){return arguments.length?(c="function"===typeof f?f:b(+f),a(),d):c};return d};Object.defineProperty(k,
"__esModule",{value:!0})})},{"d3-collection":2,"d3-dispatch":3,"d3-quadtree":5,"d3-timer":6}],5:[function(l,w,t){(function(k,e){"object"===typeof t&&"undefined"!==typeof w?e(t):"function"===typeof define&&define.amd?define(["exports"],e):e(k.d3=k.d3||{})})(this,function(k){function e(c,d,b,a){if(isNaN(d)||isNaN(b))return c;var f,h=c._root;a={data:a};var m=c._x0,e=c._y0,g=c._x1,q=c._y1,k,n,u,l;if(!h)return c._root=a,c;for(;h.length;)if((u=d>=(k=(m+g)/2))?m=k:g=k,(l=b>=(n=(e+q)/2))?e=n:q=n,f=h,!(h=
h[u|=l<<1]))return f[u]=a,c;var y=+c._x.call(null,h.data);var x=+c._y.call(null,h.data);if(d===y&&b===x)return a.next=h,f?f[u]=a:c._root=a,c;do f=f?f[u]=Array(4):c._root=Array(4),(u=d>=(k=(m+g)/2))?m=k:g=k,(l=b>=(n=(e+q)/2))?e=n:q=n;while((u|=l<<1)===(l=(x>=n)<<1|y>=k));return f[l]=h,f[u]=a,c}function a(c){return c[0]}function g(c){return c[1]}function l(c,d,b){d=new u(null==d?a:d,null==b?g:b,NaN,NaN,NaN,NaN);return null==c?d:d.addAll(c)}function u(c,d,b,a,f,h){this._x=c;this._y=d;this._x0=b;this._y0=
a;this._x1=f;this._y1=h;this._root=void 0}function n(c){for(var d={data:c.data},b=d;c=c.next;)b=b.next={data:c.data};return d}var y=function(c,d,b,a,f){this.node=c;this.x0=d;this.y0=b;this.x1=a;this.y1=f},q=l.prototype=u.prototype;q.copy=function(){var c=new u(this._x,this._y,this._x0,this._y0,this._x1,this._y1),d=this._root,b,a;if(!d)return c;if(!d.length)return c._root=n(d),c;for(b=[{source:d,target:c._root=Array(4)}];d=b.pop();)for(var f=0;4>f;++f)if(a=d.source[f])a.length?b.push({source:a,target:d.target[f]=
Array(4)}):d.target[f]=n(a);return c};q.add=function(c){var a=+this._x.call(null,c),b=+this._y.call(null,c);return e(this.cover(a,b),a,b,c)};q.addAll=function(c){var a,b,m=c.length,f,h,g=Array(m),q=Array(m),k=Infinity,n=Infinity,u=-Infinity,l=-Infinity;for(b=0;b<m;++b)isNaN(f=+this._x.call(null,a=c[b]))||isNaN(h=+this._y.call(null,a))||(g[b]=f,q[b]=h,f<k&&(k=f),f>u&&(u=f),h<n&&(n=h),h>l&&(l=h));u<k&&(k=this._x0,u=this._x1);l<n&&(n=this._y0,l=this._y1);this.cover(k,n).cover(u,l);for(b=0;b<m;++b)e(this,
g[b],q[b],c[b]);return this};q.cover=function(c,a){if(isNaN(c=+c)||isNaN(a=+a))return this;var b=this._x0,d=this._y0,f=this._x1,h=this._y1;if(isNaN(b))f=(b=Math.floor(c))+1,h=(d=Math.floor(a))+1;else if(b>c||c>f||d>a||a>h){var e=f-b,g=this._root,q;switch(q=(a<(d+h)/2)<<1|c<(b+f)/2){case 0:do{var k=Array(4);k[q]=g;g=k}while(e*=2,f=b+e,h=d+e,c>f||a>h);break;case 1:do k=Array(4),k[q]=g,g=k;while(e*=2,b=f-e,h=d+e,b>c||a>h);break;case 2:do k=Array(4),k[q]=g,g=k;while(e*=2,f=b+e,d=h-e,c>f||d>a);break;case 3:do k=
Array(4),k[q]=g,g=k;while(e*=2,b=f-e,d=h-e,b>c||d>a)}this._root&&this._root.length&&(this._root=g)}else return this;this._x0=b;this._y0=d;this._x1=f;this._y1=h;return this};q.data=function(){var c=[];this.visit(function(a){if(!a.length){do c.push(a.data);while(a=a.next)}});return c};q.extent=function(c){return arguments.length?this.cover(+c[0][0],+c[0][1]).cover(+c[1][0],+c[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]};q.find=function(c,a,b){var d=this._x0,f=this._y0,h,
e,g,q,k=this._x1,n=this._y1,u=[],l=this._root,x;l&&u.push(new y(l,d,f,k,n));null==b?b=Infinity:(d=c-b,f=a-b,k=c+b,n=a+b,b*=b);for(;x=u.pop();)if(!(!(l=x.node)||(h=x.x0)>k||(e=x.y0)>n||(g=x.x1)<d||(q=x.y1)<f))if(l.length){x=(h+g)/2;var t=(e+q)/2;u.push(new y(l[3],x,t,g,q),new y(l[2],h,t,x,q),new y(l[1],x,e,g,t),new y(l[0],h,e,x,t));if(l=(a>=t)<<1|c>=x)x=u[u.length-1],u[u.length-1]=u[u.length-1-l],u[u.length-1-l]=x}else if(x=c-+this._x.call(null,l.data),t=a-+this._y.call(null,l.data),x=x*x+t*t,x<b){var w=
Math.sqrt(b=x);d=c-w;f=a-w;k=c+w;n=a+w;w=l.data}return w};q.remove=function(c){if(isNaN(k=+this._x.call(null,c))||isNaN(n=+this._y.call(null,c)))return this;var a,b=this._root,e,f=this._x0,h=this._y0,g=this._x1,q=this._y1,k,n,u,l,x,y;if(!b)return this;if(b.length)for(;;){(x=k>=(u=(f+g)/2))?f=u:g=u;(y=n>=(l=(h+q)/2))?h=l:q=l;if(!(a=b,b=b[x|=y<<1]))return this;if(!b.length)break;if(a[x+1&3]||a[x+2&3]||a[x+3&3]){var t=a;var w=x}}for(;b.data!==c;)if(!(e=b,b=b.next))return this;(c=b.next)&&delete b.next;
if(e)return c?e.next=c:delete e.next,this;if(!a)return this._root=c,this;c?a[x]=c:delete a[x];(b=a[0]||a[1]||a[2]||a[3])&&b===(a[3]||a[2]||a[1]||a[0])&&!b.length&&(t?t[w]=b:this._root=b);return this};q.removeAll=function(a){for(var c=0,b=a.length;c<b;++c)this.remove(a[c]);return this};q.root=function(){return this._root};q.size=function(){var a=0;this.visit(function(c){if(!c.length){do++a;while(c=c.next)}});return a};q.visit=function(a){var c=[],b,e=this._root,f,h,g,q;for(e&&c.push(new y(e,this._x0,
this._y0,this._x1,this._y1));b=c.pop();)if(!a(e=b.node,h=b.x0,g=b.y0,q=b.x1,b=b.y1)&&e.length){var k=(h+q)/2,n=(g+b)/2;(f=e[3])&&c.push(new y(f,k,n,q,b));(f=e[2])&&c.push(new y(f,h,n,k,b));(f=e[1])&&c.push(new y(f,k,g,q,n));(f=e[0])&&c.push(new y(f,h,g,k,n))}return this};q.visitAfter=function(a){var c=[],b=[],e;for(this._root&&c.push(new y(this._root,this._x0,this._y0,this._x1,this._y1));e=c.pop();){var f=e.node;if(f.length){var h,g=e.x0,q=e.y0,k=e.x1,n=e.y1,u=(g+k)/2,l=(q+n)/2;(h=f[0])&&c.push(new y(h,
g,q,u,l));(h=f[1])&&c.push(new y(h,u,q,k,l));(h=f[2])&&c.push(new y(h,g,l,u,n));(h=f[3])&&c.push(new y(h,u,l,k,n))}b.push(e)}for(;e=b.pop();)a(e.node,e.x0,e.y0,e.x1,e.y1);return this};q.x=function(a){return arguments.length?(this._x=a,this):this._x};q.y=function(a){return arguments.length?(this._y=a,this):this._y};k.quadtree=l;Object.defineProperty(k,"__esModule",{value:!0})})},{}],6:[function(l,w,t){(function(k,e){"object"===typeof t&&"undefined"!==typeof w?e(t):"function"===typeof define&&define.amd?
define(["exports"],e):e(k.d3=k.d3||{})})(this,function(k){function e(){return v||(w(a),v=t.now()+z)}function a(){v=0}function g(){this._call=this._time=this._next=null}function l(b,a,c){var d=new g;d.restart(b,a,c);return d}function u(){e();++c;for(var b=m,a;b;)0<=(a=v-b._time)&&b._call.call(null,a),b=b._next;--c}function n(){v=(h=t.now())+z;c=d=0;try{u()}finally{c=0;for(var b,a=m,e,g=Infinity;a;)a._call?(g>a._time&&(g=a._time),b=a,a=a._next):(e=a._next,a._next=null,a=b?b._next=e:m=e);f=b;q(g);v=
0}}function y(){var b=t.now(),a=b-h;1E3<a&&(z-=a,h=b)}function q(a){if(!c){d&&(d=clearTimeout(d));var f=a-v;24<f?(Infinity>a&&(d=setTimeout(n,f)),b&&(b=clearInterval(b))):(b||(h=v,b=setInterval(y,1E3)),c=1,w(n))}}var c=0,d=0,b=0,m,f,h=0,v=0,z=0,t="object"===typeof performance&&performance.now?performance:Date,w="function"===typeof requestAnimationFrame?requestAnimationFrame:function(b){setTimeout(b,17)};g.prototype=l.prototype={constructor:g,restart:function(b,a,c){if("function"!==typeof b)throw new TypeError("callback is not a function");
c=(null==c?e():+c)+(null==a?0:+a);this._next||f===this||(f?f._next=this:m=this,f=this);this._call=b;this._time=c;q()},stop:function(){this._call&&(this._call=null,this._time=Infinity,q())}};k.now=e;k.timer=l;k.timerFlush=u;k.timeout=function(b,a,c){var d=new g;a=null==a?0:+a;d.restart(function(c){d.stop();b(c+a)},a,c);return d};k.interval=function(b,a,c){var d=new g,f=a;if(null==a)return d.restart(b,a,c),d;a=+a;c=null==c?e():+c;d.restart(function C(e){e+=f;d.restart(C,f+=a,c);b(e)},a,c);return d};
Object.defineProperty(k,"__esModule",{value:!0})})},{}],7:[function(l,w,t){function k(a,e){this.point=a;this.index=e}function e(a,e){a=a.point;e=e.point;for(var g=a.length,q=0;q<g;++q){var c=e[q]-a[q];if(c)return c}return 0}function a(a,e,g){if(1===a)return g?[[-1,0]]:[];e=e.map(function(a,b){return[a[0],b]});e.sort(function(a,b){return a[0]-b[0]});for(var q=Array(a-1),c=1;c<a;++c)q[c-1]=[e[c-1][1],e[c][1]];g&&q.push([-1,q[0][1]],[q[a-1][1],-1]);return q}var g=l("incremental-convex-hull"),x=l("uniq");
w.exports=function(l,n){var u=l.length;if(0===u)return[];var q=l[0].length;if(1>q)return[];if(1===q)return a(u,l,n);var c=Array(u);var d=1;for(var b=0;b<u;++b){var m=l[b];var f=Array(q+1);for(var h=0,v=0;v<q;++v){var z=m[v];f[v]=z;h+=z*z}f[q]=h;c[b]=new k(f,b);d=Math.max(h,d)}x(c,e);u=c.length;l=Array(u+q+1);for(var t=Array(u+q+1),m=Array(q+1),b=0;b<=q;++b)m[b]=0;m[q]=(q+1)*(q+1)*d;l[0]=m.slice();t[0]=-1;for(b=0;b<=q;++b)f=m.slice(),f[b]=1,l[b+1]=f,t[b+1]=-1;for(b=0;b<u;++b)d=c[b],l[b+q+1]=d.point,
t[b+q+1]=d.index;u=g(l,!1);u=n?u.filter(function(a){for(var b=0,c=0;c<=q;++c){var d=t[a[c]];if(0>d&&2<=++b)return!1;a[c]=d}return!0}):u.filter(function(a){for(var b=0;b<=q;++b){var c=t[a[b]];if(0>c)return!1;a[b]=c}return!0});if(q&1)for(b=0;b<u.length;++b)d=u[b],f=d[0],d[0]=d[1],d[1]=f;return u}},{"incremental-convex-hull":8,uniq:18}],8:[function(l,w,t){function k(a,c,d){this.vertices=a;this.adjacent=c;this.boundary=d;this.lastVisited=-1}function e(a,c,d){this.vertices=a;this.cell=c;this.index=d}function a(a,
c){return n(a.vertices,c.vertices)}function g(a){for(var c=["function orient(){var tuple=this.tuple;return test("],d=0;d<=a;++d)0<d&&c.push(","),c.push("tuple[",d,"]");c.push(")}return orient");c=new Function("test",c.join(""));(a=u[a+1])||(a=u);return c(a)}function x(a,c,d){this.dimension=a;this.vertices=c;this.simplices=d;this.interior=d.filter(function(a){return!a.boundary});this.tuple=Array(a+1);for(c=0;c<=a;++c)this.tuple[c]=this.vertices[c];(c=y[a])||(c=y[a]=g(a));this.orient=c}w.exports=function(a,
c){var d=a.length;if(0===d)throw Error("Must have at least d+1 points");var b=a[0].length;if(d<=b)throw Error("Must input at least d+1 points");var e=a.slice(0,b+1),f=u.apply(void 0,e);if(0===f)throw Error("Input not in general position");for(var h=Array(b+1),g=0;g<=b;++g)h[g]=g;0>f&&(h[0]=1,h[1]=0);for(var f=new k(h,Array(b+1),!1),q=f.adjacent,l=Array(b+2),g=0;g<=b;++g){var n=h.slice();for(var t=0;t<=b;++t)t===g&&(n[t]=-1);t=n[0];n[0]=n[1];n[1]=t;n=new k(n,Array(b+1),!0);q[g]=n;l[g]=n}l[b+1]=f;for(g=
0;g<=b;++g)for(n=q[g].vertices,h=q[g].adjacent,t=0;t<=b;++t){var y=n[t];if(0>y)h[t]=f;else for(var w=0;w<=b;++w)0>q[w].vertices.indexOf(y)&&(h[t]=q[w])}e=new x(b,e,l);c=!!c;for(g=b+1;g<d;++g)e.insert(a[g],c);return e.boundary()};var u=l("robust-orientation"),n=l("simplicial-complex").compareCells;k.prototype.flip=function(){var a=this.vertices[0];this.vertices[0]=this.vertices[1];this.vertices[1]=a;a=this.adjacent[0];this.adjacent[0]=this.adjacent[1];this.adjacent[1]=a};var y=[];l=x.prototype;l.handleBoundaryDegeneracy=
function(a,c){var d=this.dimension,b=this.vertices.length-1,e=this.tuple,f=this.vertices,h=[a];for(a.lastVisited=-b;0<h.length;){a=h.pop();a=a.adjacent;for(var g=0;g<=d;++g){var k=a[g];if(k.boundary&&!(k.lastVisited<=-b)){for(var q=k.vertices,n=0;n<=d;++n){var l=q[n];e[n]=0>l?c:f[l]}q=this.orient();if(0<q)return k;k.lastVisited=-b;0===q&&h.push(k)}}}return null};l.walk=function(a,c){var d=this.vertices.length-1,b=this.dimension,e=this.vertices,f=this.tuple,h=this.interior[c?this.interior.length*Math.random()|
0:this.interior.length-1];a:for(;!h.boundary;){var g=h.vertices;c=h.adjacent;for(var k=0;k<=b;++k)f[k]=e[g[k]];h.lastVisited=d;for(k=0;k<=b;++k)if(h=c[k],!(h.lastVisited>=d)){g=f[k];f[k]=a;var q=this.orient();f[k]=g;if(0>q)continue a;else h.lastVisited=h.boundary?-d:d}return}return h};l.addPeaks=function(g,c){var d=this.vertices.length-1,b=this.dimension,m=this.vertices,f=this.tuple,h=this.interior,q=this.simplices,n=[c];c.lastVisited=d;c.vertices[c.vertices.indexOf(-1)]=d;c.boundary=!1;h.push(c);
for(var l=[];0<n.length;){c=n.pop();var u=c.vertices,x=c.adjacent,t=u.indexOf(d);if(!(0>t))for(var y=0;y<=b;++y)if(y!==t){var w=x[y];if(w.boundary&&!(w.lastVisited>=d)){var L=w.vertices;if(w.lastVisited!==-d){for(var M=0,C=0;C<=b;++C)0>L[C]?(M=C,f[C]=g):f[C]=m[L[C]];if(0<this.orient()){L[M]=d;w.boundary=!1;h.push(w);n.push(w);w.lastVisited=d;continue}else w.lastVisited=-d}var C=w.adjacent,L=u.slice(),Q=x.slice(),M=new k(L,Q,!0);q.push(M);var T=C.indexOf(c);if(!(0>T))for(C[T]=M,Q[t]=w,L[y]=-1,Q[y]=
c,x[y]=M,M.flip(),C=0;C<=b;++C)if(w=L[C],!(0>w||w===d)){w=Array(b-1);for(T=Q=0;T<=b;++T){var K=L[T];0>K||T===C||(w[Q++]=K)}l.push(new e(w,M,C))}}}}l.sort(a);for(y=0;y+1<l.length;y+=2)g=l[y],c=l[y+1],d=c.index,0>g.index||0>d||(g.cell.adjacent[g.index]=c.cell,c.cell.adjacent[c.index]=g.cell)};l.insert=function(a,c){var d=this.vertices;d.push(a);if(c=this.walk(a,c)){for(var b=this.dimension,e=this.tuple,f=0;f<=b;++f){var h=c.vertices[f];e[f]=0>h?a:d[h]}d=this.orient(e);if(!(0>d)){if(0===d&&(c=this.handleBoundaryDegeneracy(c,
a),!c))return;this.addPeaks(a,c)}}};l.boundary=function(){for(var a=this.dimension,c=[],d=this.simplices,b=d.length,e=0;e<b;++e){var f=d[e];if(f.boundary){for(var h=Array(a),f=f.vertices,g=0,k=0,n=0;n<=a;++n)0<=f[n]?h[g++]=f[n]:k=n&1;k===(a&1)&&(f=h[0],h[0]=h[1],h[1]=f);c.push(h)}}return c}},{"robust-orientation":10,"simplicial-complex":14}],9:[function(l,w,t){(function(k,e){"object"===typeof t&&"undefined"!==typeof w?w.exports=e():"function"===typeof define&&define.amd?define(e):k.createREGL=e()})(this,
function(){function k(a){return"undefined"!==typeof btoa?btoa(a):"base64:"+a}function e(a){a=Error("(regl) "+a);console.error(a);throw a;}function a(a,b){a||e(b)}function g(a){return a?": "+a:""}function l(a,b,c){0>b.indexOf(a)&&e("invalid value"+g(c)+". must be one of: "+b)}function u(a,b){for(a+="";a.length<b;)a=" "+a;return a}function n(){this.name="unknown";this.lines=[];this.index={};this.hasErrors=!1}function t(a,b){this.number=a;this.line=b;this.errors=[]}function q(a,b,c){this.file=a;this.line=
b;this.message=c}function c(){var a=Error(),a=(a.stack||a).toString(),b=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(a);return b?b[1]:(a=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(a))?a[1]:"unknown"}function d(){var a=Error(),a=(a.stack||a).toString(),b=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(a);return b?b[1]:(a=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(a))?a[1]:"unknown"}function b(a,b){a=a.split("\n");var d=1,r=0,e={unknown:new n,0:new n};e.unknown.name=e[0].name=b||c();e.unknown.lines.push(new t(0,
""));for(b=0;b<a.length;++b){var f=a[b],h=/^\s*\#\s*(\w+)\s+(.+)\s*$/.exec(f);if(h)switch(h[1]){case "line":if(h=/(\d+)(\s+\d+)?/.exec(h[2]))d=h[1]|0,h[2]&&(r=h[2]|0,r in e||(e[r]=new n));break;case "define":if(h=/SHADER_NAME(_B64)?\s+(.*)$/.exec(h[2]))e[r].name=h[1]?k(h[2]):h[2]}e[r].lines.push(new t(d++,f))}Object.keys(e).forEach(function(a){var b=e[a];b.lines.forEach(function(a){b.index[a.number]=a})});return e}function m(a){var b=[];a.split("\n").forEach(function(a){if(!(5>a.length)){var c=/^ERROR\:\s+(\d+)\:(\d+)\:\s*(.*)$/.exec(a);
c?b.push(new q(c[1]|0,c[2]|0,c[3].trim())):0<a.length&&b.push(new q("unknown",0,a))}});return b}function f(a,b){b.forEach(function(b){var c=a[b.file];if(c){var d=c.index[b.line];if(d){d.errors.push(b);c.hasErrors=!0;return}}a.unknown.hasErrors=!0;a.unknown.lines[0].errors.push(b)})}function h(a){a._commandRef=c()}function v(a,b){var r=d();e(a+" in command "+(b||c())+("unknown"===r?"":" called from "+r))}function w(a,b,d,e){typeof a!==b&&v("invalid parameter type"+g(d)+". expected "+b+", got "+typeof a,
e||c())}function A(a,b){return 32820===a||32819===a||33635===a?2:34042===a?4:W[a]*b}function P(a,b){this.id=Gb++;this.type=a;this.data=b}function J(a){if(0===a.length)return[];var b=a.charAt(0),c=a.charAt(a.length-1);if(1<a.length&&b===c&&('"'===b||"'"===b))return['"'+a.substr(1,a.length-2).replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];if(b=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(a))return J(a.substr(0,b.index)).concat(J(b[1])).concat(J(a.substr(b.index+b[0].length)));b=a.split(".");if(1===
b.length)return['"'+a.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];a=[];for(c=0;c<b.length;++c)a=a.concat(J(b[c]));return a}function fa(a){return"["+J(a).join("][")+"]"}function X(){var a={"":0},b=[""];return{id:function(c){var d=a[c];if(d)return d;d=a[c]=b.length;b.push(c);return d},str:function(a){return b[a]}}}function Ga(a,b,c){function d(){var b=window.innerWidth,d=window.innerHeight;a!==document.body&&(d=a.getBoundingClientRect(),b=d.right-d.left,d=d.bottom-d.top);e.width=c*b;e.height=c*d;
N(e.style,{width:b+"px",height:d+"px"})}var e=document.createElement("canvas");N(e.style,{border:0,margin:0,padding:0,top:0,left:0});a.appendChild(e);a===document.body&&(e.style.position="absolute",N(a.style,{margin:0,padding:0}));window.addEventListener("resize",d,!1);d();return{canvas:e,onDestroy:function(){window.removeEventListener("resize",d);a.removeChild(e)}}}function L(a,b){function c(c){try{return a.getContext(c,b)}catch(da){return null}}return c("webgl")||c("experimental-webgl")||c("webgl-experimental")}
function M(a){if("string"===typeof a)return a.split();p(Array.isArray(a),"invalid extension array");return a}function C(a){return"string"===typeof a?(p("undefined"!==typeof document,"not supported outside of DOM"),document.querySelector(a)):a}function Q(a){var b=a||{},c;a={};var d=[],e=[],r="undefined"===typeof window?1:window.devicePixelRatio,f=!1,h=function(a){a&&p.raise(a)},g=function(){};if("string"===typeof b){p("undefined"!==typeof document,"selector queries only supported in DOM enviroments");
var m=document.querySelector(b);p(m,"invalid query string for element")}else if("object"===typeof b)if("string"===typeof b.nodeName&&"function"===typeof b.appendChild&&"function"===typeof b.getBoundingClientRect)m=b;else if("function"===typeof b.drawArrays||"function"===typeof b.drawElements){var k=b;var n=k.canvas}else p.constructor(b),"gl"in b?k=b.gl:"canvas"in b?n=C(b.canvas):"container"in b&&(c=C(b.container)),"attributes"in b&&(a=b.attributes,p.type(a,"object","invalid context attributes")),
"extensions"in b&&(d=M(b.extensions)),"optionalExtensions"in b&&(e=M(b.optionalExtensions)),"onDone"in b&&(p.type(b.onDone,"function","invalid or missing onDone callback"),h=b.onDone),"profile"in b&&(f=!!b.profile),"pixelRatio"in b&&(r=+b.pixelRatio,p(0<r,"invalid pixel ratio"));else p.raise("invalid arguments to regl");m&&("canvas"===m.nodeName.toLowerCase()?n=m:c=m);if(!k){if(!n){p("undefined"!==typeof document,"must manually specify webgl context outside of DOM environments");m=Ga(c||document.body,
h,r);if(!m)return null;n=m.canvas;g=m.onDestroy}k=L(n,a)}return k?{gl:k,canvas:n,container:c,extensions:d,optionalExtensions:e,pixelRatio:r,profile:f,onDone:h,onDestroy:g}:(g(),h("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function T(a,b){function c(b){p.type(b,"string","extension name must be string");b=b.toLowerCase();try{var c=d[b]=a.getExtension(b)}catch(ma){}return!!c}for(var d={},e=0;e<b.extensions.length;++e){var r=b.extensions[e];if(!c(r))return b.onDestroy(),
b.onDone('"'+r+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}b.optionalExtensions.forEach(c);return{extensions:d,restore:function(){Object.keys(d).forEach(function(a){if(!c(a))throw Error("(regl): error restoring extension "+a);})}}}function K(a){return!!a&&"object"===typeof a&&Array.isArray(a.shape)&&Array.isArray(a.stride)&&"number"===typeof a.offset&&a.shape.length===a.stride.length&&(Array.isArray(a.data)||E(a.data))}function R(a,
b){for(var c=Array(a),d=0;d<a;++d)c[d]=b(d);return c}function Ha(a){var b=(65535<a)<<4;a>>>=b;var c=(255<a)<<3;a>>>=c;b|=c;c=(15<a)<<2;a>>>=c;b|=c;c=(3<a)<<1;return b|c|a>>>c>>1}function Z(a){a:{for(var b=16;268435456>=b;b*=16)if(a<=b){a=b;break a}a=0}b=lb[Ha(a)>>2];return 0<b.length?b.pop():new ArrayBuffer(a)}function fb(a){lb[Ha(a.byteLength)>>2].push(a)}function gb(a,b,c,d,e,f){for(var r=0;r<b;++r)for(var h=a[r],g=0;g<c;++g)for(var p=h[g],m=0;m<d;++m)e[f++]=p[m]}function hb(a,b,c,d,e){for(var f=
1,r=c+1;r<b.length;++r)f*=b[r];var h=b[c];if(4===b.length-c){var g=b[c+1],p=b[c+2];b=b[c+3];for(r=0;r<h;++r)gb(a[r],g,p,b,d,e),e+=f}else for(r=0;r<h;++r)hb(a[r],b,c+1,d,e),e+=f}function Oa(a){return Ia[Object.prototype.toString.call(a)]|0}function ib(a,b){for(var c=0;c<b.length;++c)a[c]=b[c]}function jb(a,b,c,d,e,f,h){for(var r=0,g=0;g<c;++g)for(var p=0;p<d;++p)a[r++]=b[e*g+f*p+h]}function Fb(a,b,c){function d(b){this.id=r++;this.buffer=a.createBuffer();this.type=b;this.usage=35044;this.byteLength=
0;this.dimension=1;this.dtype=5121;this.persistentData=null;c.profile&&(this.stats={size:0})}function e(b,c,d){b.byteLength=c.byteLength;a.bufferData(b.type,c,d)}function f(a,b,c,d,f,h){a.usage=c;if(Array.isArray(b)){if(a.dtype=d||5126,0<b.length)if(Array.isArray(b[0])){f=mb(b);for(var r=d=1;r<f.length;++r)d*=f[r];a.dimension=d;b=$a(b,f,a.dtype);e(a,b,c);h?a.persistentData=b:G.freeType(b)}else"number"===typeof b[0]?(a.dimension=f,f=G.allocType(a.dtype,b.length),ib(f,b),e(a,f,c),h?a.persistentData=
f:G.freeType(f)):E(b[0])?(a.dimension=b[0].length,a.dtype=d||Oa(b[0])||5126,b=$a(b,[b.length,b[0].length],a.dtype),e(a,b,c),h?a.persistentData=b:G.freeType(b)):p.raise("invalid buffer data")}else if(E(b))a.dtype=d||Oa(b),a.dimension=f,e(a,b,c),h&&(a.persistentData=new Uint8Array(new Uint8Array(b.buffer)));else if(K(b)){f=b.shape;var g=b.stride,r=b.offset,m=0,k=0,n=0,q=0;1===f.length?(m=f[0],k=1,n=g[0],q=0):2===f.length?(m=f[0],k=f[1],n=g[0],q=g[1]):p.raise("invalid shape");a.dtype=d||Oa(b.data)||
5126;a.dimension=k;f=G.allocType(a.dtype,m*k);jb(f,b.data,m,k,n,q,r);e(a,f,c);h?a.persistentData=f:G.freeType(f)}else p.raise("invalid buffer data")}function h(c){b.bufferCount--;var d=c.buffer;p(d,"buffer must not be deleted already");a.deleteBuffer(d);c.buffer=null;delete g[c.id]}var r=0,g={};d.prototype.bind=function(){a.bindBuffer(this.type,this.buffer)};d.prototype.destroy=function(){h(this)};var m=[];c.profile&&(b.getTotalBufferSize=function(){var a=0;Object.keys(g).forEach(function(b){a+=g[b].stats.size});
return a});return{create:function(e,r,m,k){function n(b){var d=35044,e=null,h=0,r=0,g=1;Array.isArray(b)||E(b)||K(b)?e=b:"number"===typeof b?h=b|0:b&&(p.type(b,"object","buffer arguments must be an object, a number or an array"),"data"in b&&(p(null===e||Array.isArray(e)||E(e)||K(e),"invalid data for buffer"),e=b.data),"usage"in b&&(p.parameter(b.usage,Ta,"invalid buffer usage"),d=Ta[b.usage]),"type"in b&&(p.parameter(b.type,Ja,"invalid buffer type"),r=Ja[b.type]),"dimension"in b&&(p.type(b.dimension,
"number","invalid dimension"),g=b.dimension|0),"length"in b&&(p.nni(h,"buffer length must be a nonnegative integer"),h=b.length|0));l.bind();e?f(l,e,d,r,g,k):(a.bufferData(l.type,h,d),l.dtype=r||5121,l.usage=d,l.dimension=g,l.byteLength=h);c.profile&&(l.stats.size=l.byteLength*qa[l.dtype]);return n}function q(b,c){p(c+b.byteLength<=l.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+b.byteLength+" starting from offset "+c+" to a buffer of size "+l.byteLength);
a.bufferSubData(l.type,c,b)}b.bufferCount++;var l=new d(r);g[l.id]=l;m||n(e);n._reglType="buffer";n._buffer=l;n.subdata=function(a,b){b=(b||0)|0;l.bind();if(Array.isArray(a)){if(0<a.length)if("number"===typeof a[0]){var c=G.allocType(l.dtype,a.length);ib(c,a);q(c,b);G.freeType(c)}else if(Array.isArray(a[0])||E(a[0])){var d=mb(a);a=$a(a,d,l.dtype);q(a,b);G.freeType(a)}else p.raise("invalid buffer data")}else if(E(a))q(a,b);else if(K(a)){d=a.shape;var e=a.stride,f=c=0,h=0,r=0;1===d.length?(c=d[0],f=
1,h=e[0],r=0):2===d.length?(c=d[0],f=d[1],h=e[0],r=e[1]):p.raise("invalid shape");d=Array.isArray(a.data)?l.dtype:Oa(a.data);d=G.allocType(d,c*f);jb(d,a.data,c,f,h,r,a.offset);q(d,b);G.freeType(d)}else p.raise("invalid data for buffer subdata");return n};c.profile&&(n.stats=l.stats);n.destroy=function(){h(l)};return n},createStream:function(a,b){var c=m.pop();c||(c=new d(a));c.bind();f(c,b,35040,0,1,!1);return c},destroyStream:function(a){m.push(a)},clear:function(){ja(g).forEach(h);m.forEach(h)},
getBuffer:function(a){return a&&a._buffer instanceof d?a._buffer:null},restore:function(){ja(g).forEach(function(b){b.buffer=a.createBuffer();a.bindBuffer(b.type,b.buffer);a.bufferData(b.type,b.persistentData||b.byteLength,b.usage)})},_initBuffer:f}}function Hb(a,b,c,d){function e(a){this.id=g++;r[this.id]=this;this.buffer=a;this.primType=4;this.type=this.vertCount=0}function f(d,e,f,h,r,g,m){d.buffer.bind();if(e){var k=m;m||E(e)&&(!K(e)||E(e.data))||(k=b.oes_element_index_uint?5125:5123);c._initBuffer(d.buffer,
e,f,k,3)}else a.bufferData(34963,g,f),d.buffer.dtype=k||5121,d.buffer.usage=f,d.buffer.dimension=3,d.buffer.byteLength=g;k=m;if(!m){switch(d.buffer.dtype){case 5121:case 5120:k=5121;break;case 5123:case 5122:k=5123;break;case 5125:case 5124:k=5125;break;default:p.raise("unsupported type for element array")}d.buffer.dtype=k}d.type=k;p(5125!==k||!!b.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");e=r;0>e&&(e=d.buffer.byteLength,5123===k?e>>=1:5125===
k&&(e>>=2));d.vertCount=e;e=h;0>h&&(e=4,h=d.buffer.dimension,1===h&&(e=0),2===h&&(e=1),3===h&&(e=4));d.primType=e}function h(a){d.elementsCount--;p(null!==a.buffer,"must not double destroy elements");delete r[a.id];a.buffer.destroy();a.buffer=null}var r={},g=0,m={uint8:5121,uint16:5123};b.oes_element_index_uint&&(m.uint32=5125);e.prototype.bind=function(){this.buffer.bind()};var k=[];return{create:function(a,b){function r(a){if(a)if("number"===typeof a)g(a),k.primType=4,k.vertCount=a|0,k.type=5121;
else{var b=null,c=35044,d=-1,e=-1,h=0,n=0;if(Array.isArray(a)||E(a)||K(a))b=a;else if(p.type(a,"object","invalid arguments for elements"),"data"in a&&(b=a.data,p(Array.isArray(b)||E(b)||K(b),"invalid data for element buffer")),"usage"in a&&(p.parameter(a.usage,Ta,"invalid element buffer usage"),c=Ta[a.usage]),"primitive"in a&&(p.parameter(a.primitive,za,"invalid element buffer primitive"),d=za[a.primitive]),"count"in a&&(p("number"===typeof a.count&&0<=a.count,"invalid vertex count for elements"),
e=a.count|0),"type"in a&&(p.parameter(a.type,m,"invalid buffer type"),n=m[a.type]),"length"in a)h=a.length|0;else if(h=e,5123===n||5122===n)h*=2;else if(5125===n||5124===n)h*=4;f(k,b,c,d,e,h,n)}else g(),k.primType=4,k.vertCount=0,k.type=5121;return r}var g=c.create(null,34963,!0),k=new e(g._buffer);d.elementsCount++;r(a);r._reglType="elements";r._elements=k;r.subdata=function(a,b){g.subdata(a,b);return r};r.destroy=function(){h(k)};return r},createStream:function(a){var b=k.pop();b||(b=new e(c.create(null,
34963,!0,!1)._buffer));f(b,a,35040,-1,-1,0,0);return b},destroyStream:function(a){k.push(a)},getElements:function(a){return"function"===typeof a&&a._elements instanceof e?a._elements:null},clear:function(){ja(r).forEach(h)}}}function nb(a){for(var b=G.allocType(5123,a.length),c=0;c<a.length;++c)if(isNaN(a[c]))b[c]=65535;else if(Infinity===a[c])b[c]=31744;else if(-Infinity===a[c])b[c]=64512;else{ob[0]=a[c];var d=Ib[0],e=d>>>31<<15,f=(d<<1>>>24)-127,d=d>>13&1023;b[c]=-24>f?e:-14>f?e+(d+1024>>-14-f):
15<f?e+31744:e+(f+15<<10)+d}return b}function H(a){return Array.isArray(a)||E(a)}function pb(a){return Array.isArray(a)&&(0===a.length||"number"===typeof a[0])}function qb(a){return Array.isArray(a)&&0!==a.length&&H(a[0])?!0:!1}function Aa(a){return Object.prototype.toString.call(a)}function ab(a){if(!a)return!1;var b=Aa(a);return 0<=Jb.indexOf(b)?!0:pb(a)||qb(a)||K(a)}function rb(a,b){36193===a.type?(a.data=nb(b),G.freeType(b)):a.data=b}function Ua(a,b,c,d,e,f){a="undefined"!==typeof F[a]?F[a]:U[a]*
Ba[b];f&&(a*=6);if(e){for(d=0;1<=c;)d+=a*c*c,c/=2;return d}return a*c*d}function Kb(a,b,c,d,e,f,h){function g(){this.format=this.internalformat=6408;this.type=5121;this.flipY=this.premultiplyAlpha=this.compressed=!1;this.unpackAlignment=1;this.channels=this.height=this.width=this.colorSpace=0}function r(a,b){a.internalformat=b.internalformat;a.format=b.format;a.type=b.type;a.compressed=b.compressed;a.premultiplyAlpha=b.premultiplyAlpha;a.flipY=b.flipY;a.unpackAlignment=b.unpackAlignment;a.colorSpace=
b.colorSpace;a.width=b.width;a.height=b.height;a.channels=b.channels}function k(a,d){if("object"===typeof d&&d){"premultiplyAlpha"in d&&(p.type(d.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),a.premultiplyAlpha=d.premultiplyAlpha);"flipY"in d&&(p.type(d.flipY,"boolean","invalid texture flip"),a.flipY=d.flipY);"alignment"in d&&(p.oneOf(d.alignment,[1,2,4,8],"invalid texture unpack alignment"),a.unpackAlignment=d.alignment);"colorSpace"in d&&(p.parameter(d.colorSpace,sb,"invalid colorSpace"),
a.colorSpace=sb[d.colorSpace]);if("type"in d){var e=d.type;p(b.oes_texture_float||!("float"===e||"float32"===e),"you must enable the OES_texture_float extension in order to use floating point textures.");p(b.oes_texture_half_float||!("half float"===e||"float16"===e),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures.");p(b.webgl_depth_texture||!("uint16"===e||"uint32"===e||"depth stencil"===e),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures.");
p.parameter(e,ba,"invalid texture type");a.type=ba[e]}var f=a.width,h=a.height,g=a.channels,e=!1;"shape"in d?(p(Array.isArray(d.shape)&&2<=d.shape.length,"shape must be an array"),f=d.shape[0],h=d.shape[1],3===d.shape.length&&(g=d.shape[2],p(0<g&&4>=g,"invalid number of channels"),e=!0),p(0<=f&&f<=c.maxTextureSize,"invalid width"),p(0<=h&&h<=c.maxTextureSize,"invalid height")):("radius"in d&&(f=h=d.radius,p(0<=f&&f<=c.maxTextureSize,"invalid radius")),"width"in d&&(f=d.width,p(0<=f&&f<=c.maxTextureSize,
"invalid width")),"height"in d&&(h=d.height,p(0<=h&&h<=c.maxTextureSize,"invalid height")),"channels"in d&&(g=d.channels,p(0<g&&4>=g,"invalid number of channels"),e=!0));a.width=f|0;a.height=h|0;a.channels=g|0;f=!1;"format"in d&&(f=d.format,p(b.webgl_depth_texture||!("depth"===f||"depth stencil"===f),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),p.parameter(f,O,"invalid texture format"),h=a.internalformat=O[f],a.format=Lb[h],f in ba&&!("type"in d)&&(a.type=
ba[f]),f in wa&&(a.compressed=!0),f=!0);!e&&f?a.channels=U[a.format]:e&&!f?a.channels!==Va[a.format]&&(a.format=a.internalformat=Va[a.channels]):f&&e&&p(a.channels===U[a.format],"number of channels inconsistent with specified format")}}function m(b){a.pixelStorei(37440,b.flipY);a.pixelStorei(37441,b.premultiplyAlpha);a.pixelStorei(37443,b.colorSpace);a.pixelStorei(3317,b.unpackAlignment)}function n(){g.call(this);this.yOffset=this.xOffset=0;this.data=null;this.needsFree=!1;this.element=null;this.needsCopy=
!1}function l(a,b){var d=null;ab(b)?d=b:b&&(p.type(b,"object","invalid pixel data type"),k(a,b),"x"in b&&(a.xOffset=b.x|0),"y"in b&&(a.yOffset=b.y|0),ab(b.data)&&(d=b.data));p(!a.compressed||d instanceof Uint8Array,"compressed texture data must be stored in a uint8array");if(b.copy)p(!d,"can not specify copy and data field for the same texture"),b=e.viewportWidth,d=e.viewportHeight,a.width=a.width||b-a.xOffset,a.height=a.height||d-a.yOffset,a.needsCopy=!0,p(0<=a.xOffset&&a.xOffset<b&&0<=a.yOffset&&
a.yOffset<d&&0<a.width&&a.width<=b&&0<a.height&&a.height<=d,"copy texture read out of bounds");else if(!d)a.width=a.width||1,a.height=a.height||1,a.channels=a.channels||4;else if(E(d))a.channels=a.channels||4,a.data=d,"type"in b||5121!==a.type||(a.type=Ia[Object.prototype.toString.call(d)]|0);else if(pb(d)){a.channels=a.channels||4;b=d;d=b.length;switch(a.type){case 5121:case 5123:case 5125:case 5126:d=G.allocType(a.type,d);d.set(b);a.data=d;break;case 36193:a.data=nb(b);break;default:p.raise("unsupported texture type, must specify a typed array")}a.alignment=
1;a.needsFree=!0}else if(K(d)){b=d.data;Array.isArray(b)||5121!==a.type||(a.type=Ia[Object.prototype.toString.call(b)]|0);var f=d.shape,h=d.stride;if(3===f.length){var g=f[2];var r=h[2]}else p(2===f.length,"invalid ndarray pixel data, must be 2 or 3D"),r=g=1;var m=f[0];var D=f[1];f=h[0];h=h[1];a.alignment=1;a.width=m;a.height=D;a.channels=g;a.format=a.internalformat=Va[g];a.needsFree=!0;m=r;d=d.offset;g=a.width;r=a.height;D=a.channels;for(var ka=G.allocType(36193===a.type?5126:a.type,g*r*D),n=0,l=
0;l<r;++l)for(var q=0;q<g;++q)for(var bb=0;bb<D;++bb)ka[n++]=b[f*q+h*l+m*bb+d];rb(a,ka)}else if("[object HTMLCanvasElement]"===Aa(d)||"[object CanvasRenderingContext2D]"===Aa(d))"[object HTMLCanvasElement]"===Aa(d)?a.element=d:a.element=d.canvas,a.width=a.element.width,a.height=a.element.height,a.channels=4;else if("[object HTMLImageElement]"===Aa(d))a.element=d,a.width=d.naturalWidth,a.height=d.naturalHeight,a.channels=4;else if("[object HTMLVideoElement]"===Aa(d))a.element=d,a.width=d.videoWidth,
a.height=d.videoHeight,a.channels=4;else if(qb(d)){b=a.width||d[0].length;f=a.height||d.length;h=a.channels;h=H(d[0][0])?h||d[0][0].length:h||1;m=Wa.shape(d);g=1;for(r=0;r<m.length;++r)g*=m[r];g=G.allocType(36193===a.type?5126:a.type,g);Wa.flatten(d,m,"",g);rb(a,g);a.alignment=1;a.width=b;a.height=f;a.channels=h;a.format=a.internalformat=Va[h];a.needsFree=!0}5126===a.type?p(0<=c.extensions.indexOf("oes_texture_float"),"oes_texture_float extension not enabled"):36193===a.type&&p(0<=c.extensions.indexOf("oes_texture_half_float"),
"oes_texture_half_float extension not enabled")}function q(b,c,e,f,h){var g=b.element,r=b.data,k=b.internalformat,D=b.format,ka=b.type,p=b.width,n=b.height;m(b);g?a.texSubImage2D(c,h,e,f,D,ka,g):b.compressed?a.compressedTexSubImage2D(c,h,e,f,k,p,n,r):b.needsCopy?(d(),a.copyTexSubImage2D(c,h,e,f,b.xOffset,b.yOffset,p,n)):a.texSubImage2D(c,h,e,f,p,n,D,ka,r)}function u(){return tb.pop()||new n}function aa(a){a.needsFree&&G.freeType(a.data);n.call(a);tb.push(a)}function v(){g.call(this);this.genMipmaps=
!1;this.mipmapHint=4352;this.mipmask=0;this.images=Array(16)}function x(a,b,c){var d=a.images[0]=u();a.mipmask=1;d.width=a.width=b;d.height=a.height=c;d.channels=a.channels=4}function t(a,b){if(ab(b)){var c=a.images[0]=u();r(c,a);l(c,b);a.mipmask=1}else if(k(a,b),Array.isArray(b.mipmap)){b=b.mipmap;for(var d=0;d<b.length;++d)c=a.images[d]=u(),r(c,a),c.width>>=d,c.height>>=d,l(c,b[d]),a.mipmask|=1<<d}else c=a.images[0]=u(),r(c,a),l(c,b),a.mipmask=1;r(a,a.images[0]);(a.compressed&&33776===a.internalformat||
33777===a.internalformat||33778===a.internalformat||33779===a.internalformat)&&p(0===a.width%4&&0===a.height%4,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function y(b,c){b=b.images;for(var e=0;e<b.length&&b[e];++e){var f=b[e],h=c,g=e,r=f.element,k=f.data,D=f.internalformat,ka=f.format,p=f.type,n=f.width,l=f.height;m(f);r?a.texImage2D(h,g,ka,ka,p,r):f.compressed?a.compressedTexImage2D(h,g,D,n,l,0,k):f.needsCopy?(d(),a.copyTexImage2D(h,g,ka,
f.xOffset,f.yOffset,n,l,0)):a.texImage2D(h,g,ka,n,l,0,ka,p,k)}}function w(){var a=X.pop()||new v;g.call(a);for(var b=a.mipmask=0;16>b;++b)a.images[b]=null;return a}function pa(a){for(var b=a.images,c=0;c<b.length;++c)b[c]&&aa(b[c]),b[c]=null;X.push(a)}function z(){this.magFilter=this.minFilter=9728;this.wrapT=this.wrapS=33071;this.anisotropic=1;this.genMipmaps=!1;this.mipmapHint=4352}function ia(a,b){if("min"in b){var d=b.min;p.parameter(d,Xa);a.minFilter=Xa[d];0<=Mb.indexOf(a.minFilter)&&(a.genMipmaps=
!0)}"mag"in b&&(d=b.mag,p.parameter(d,Ma),a.magFilter=Ma[d]);var d=a.wrapS,e=a.wrapT;if("wrap"in b){var f=b.wrap;"string"===typeof f?(p.parameter(f,ga),d=e=ga[f]):Array.isArray(f)&&(p.parameter(f[0],ga),p.parameter(f[1],ga),d=ga[f[0]],e=ga[f[1]])}else"wrapS"in b&&(d=b.wrapS,p.parameter(d,ga),d=ga[d]),"wrapT"in b&&(e=b.wrapT,p.parameter(e,ga),e=ga[e]);a.wrapS=d;a.wrapT=e;"anisotropic"in b&&(d=b.anisotropic,p("number"===typeof d&&1<=d&&d<=c.maxAnisotropic,"aniso samples must be between 1 and "),a.anisotropic=
b.anisotropic);if("mipmap"in b){d=!1;switch(typeof b.mipmap){case "string":p.parameter(b.mipmap,ub,"invalid mipmap hint");a.mipmapHint=ub[b.mipmap];d=a.genMipmaps=!0;break;case "boolean":d=a.genMipmaps=b.mipmap;break;case "object":p(Array.isArray(b.mipmap),"invalid mipmap type");a.genMipmaps=!1;d=!0;break;default:p.raise("invalid mipmap type")}!d||"min"in b||(a.minFilter=9984)}}function A(c,d){a.texParameteri(d,10241,c.minFilter);a.texParameteri(d,10240,c.magFilter);a.texParameteri(d,10242,c.wrapS);
a.texParameteri(d,10243,c.wrapT);b.ext_texture_filter_anisotropic&&a.texParameteri(d,34046,c.anisotropic);c.genMipmaps&&(a.hint(33170,c.mipmapHint),a.generateMipmap(d))}function cb(b){g.call(this);this.mipmask=0;this.internalformat=6408;this.id=M++;this.refCount=1;this.target=b;this.texture=a.createTexture();this.unit=-1;this.bindCount=0;this.texInfo=new z;h.profile&&(this.stats={size:0})}function da(b){a.activeTexture(33984);a.bindTexture(b.target,b.texture)}function ea(){var b=Q[0];b?a.bindTexture(b.target,
b.texture):a.bindTexture(3553,null)}function vb(b){var c=b.texture;p(c,"must not double destroy texture");var d=b.unit,e=b.target;0<=d&&(a.activeTexture(33984+d),a.bindTexture(e,null),Q[d]=null);a.deleteTexture(c);b.texture=null;b.params=null;b.pixels=null;b.refCount=0;delete V[b.id];f.textureCount--}var ub={"don't care":4352,"dont care":4352,nice:4354,fast:4353},ga={repeat:10497,clamp:33071,mirror:33648},Ma={nearest:9728,linear:9729},Xa=N({mipmap:9987,"nearest mipmap nearest":9984,"linear mipmap nearest":9985,
"nearest mipmap linear":9986,"linear mipmap linear":9987},Ma),sb={none:0,browser:37444},ba={uint8:5121,rgba4:32819,rgb565:33635,"rgb5 a1":32820},O={alpha:6406,luminance:6409,"luminance alpha":6410,rgb:6407,rgba:6408,rgba4:32854,"rgb5 a1":32855,rgb565:36194},wa={};b.ext_srgb&&(O.srgb=35904,O.srgba=35906);b.oes_texture_float&&(ba.float32=ba.float=5126);b.oes_texture_half_float&&(ba.float16=ba["half float"]=36193);b.webgl_depth_texture&&(N(O,{depth:6402,"depth stencil":34041}),N(ba,{uint16:5123,uint32:5125,
"depth stencil":34042}));b.webgl_compressed_texture_s3tc&&N(wa,{"rgb s3tc dxt1":33776,"rgba s3tc dxt1":33777,"rgba s3tc dxt3":33778,"rgba s3tc dxt5":33779});b.webgl_compressed_texture_atc&&N(wa,{"rgb atc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798});b.webgl_compressed_texture_pvrtc&&N(wa,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,"rgba pvrtc 2bppv1":35843});b.webgl_compressed_texture_etc1&&(wa["rgb etc1"]=36196);var P=Array.prototype.slice.call(a.getParameter(34467));
Object.keys(wa).forEach(function(a){var b=wa[a];0<=P.indexOf(b)&&(O[a]=b)});var J=Object.keys(O);c.textureFormats=J;var C=[];Object.keys(O).forEach(function(a){C[O[a]]=a});var I=[];Object.keys(ba).forEach(function(a){I[ba[a]]=a});var Na=[];Object.keys(Ma).forEach(function(a){Na[Ma[a]]=a});var xa=[];Object.keys(Xa).forEach(function(a){xa[Xa[a]]=a});var ya=[];Object.keys(ga).forEach(function(a){ya[ga[a]]=a});var Lb=J.reduce(function(a,b){var c=O[b];6409===c||6406===c||6409===c||6410===c||6402===c||
34041===c?a[c]=c:32855===c||0<=b.indexOf("rgba")?a[c]=6408:a[c]=6407;return a},{}),tb=[],X=[],M=0,V={},F=c.maxTextureUnits,Q=Array(F).map(function(){return null});N(cb.prototype,{bind:function(){this.bindCount+=1;var b=this.unit;if(0>b){for(var c=0;c<F;++c){var d=Q[c];if(d){if(0<d.bindCount)continue;d.unit=-1}Q[c]=this;b=c;break}b>=F&&p.raise("insufficient number of texture units");h.profile&&f.maxTextureUnits<b+1&&(f.maxTextureUnits=b+1);this.unit=b;a.activeTexture(33984+b);a.bindTexture(this.target,
this.texture)}return b},unbind:function(){--this.bindCount},decRef:function(){0>=--this.refCount&&vb(this)}});h.profile&&(f.getTotalTextureSize=function(){var a=0;Object.keys(V).forEach(function(b){a+=V[b].stats.size});return a});return{create2D:function(b,d){function e(a,b){var d=g.texInfo;z.call(d);var f=w();"number"===typeof a?"number"===typeof b?x(f,a|0,b|0):x(f,a|0,a|0):a?(p.type(a,"object","invalid arguments to regl.texture"),ia(d,a),t(f,a)):x(f,1,1);d.genMipmaps&&(f.mipmask=(f.width<<1)-1);
g.mipmask=f.mipmask;r(g,f);p.texture2D(d,f,c);g.internalformat=f.internalformat;e.width=f.width;e.height=f.height;da(g);y(f,3553);A(d,3553);ea();pa(f);h.profile&&(g.stats.size=Ua(g.internalformat,g.type,f.width,f.height,d.genMipmaps,!1));e.format=C[g.internalformat];e.type=I[g.type];e.mag=Na[d.magFilter];e.min=xa[d.minFilter];e.wrapS=ya[d.wrapS];e.wrapT=ya[d.wrapT];return e}var g=new cb(3553);V[g.id]=g;f.textureCount++;e(b,d);e.subimage=function(a,b,c,d){p(!!a,"must specify image data");b|=0;c|=0;
d|=0;var f=u();r(f,g);f.width=0;f.height=0;l(f,a);f.width=f.width||(g.width>>d)-b;f.height=f.height||(g.height>>d)-c;p(g.type===f.type&&g.format===f.format&&g.internalformat===f.internalformat,"incompatible format for texture.subimage");p(0<=b&&0<=c&&b+f.width<=g.width&&c+f.height<=g.height,"texture.subimage write out of bounds");p(g.mipmask&1<<d,"missing mipmap data");p(f.data||f.element||f.needsCopy,"missing image data");da(g);q(f,3553,b,c,d);ea();aa(f);return e};e.resize=function(b,c){b|=0;c=c|
0||b;if(b===g.width&&c===g.height)return e;e.width=g.width=b;e.height=g.height=c;da(g);for(var d=0;g.mipmask>>d;++d)a.texImage2D(3553,d,g.format,b>>d,c>>d,0,g.format,g.type,null);ea();h.profile&&(g.stats.size=Ua(g.internalformat,g.type,b,c,!1,!1));return e};e._reglType="texture2d";e._texture=g;h.profile&&(e.stats=g.stats);e.destroy=function(){g.decRef()};return e},createCube:function(b,d,e,g,m,n){function v(a,b,d,e,f,g){var m,na=B.texInfo;z.call(na);for(m=0;6>m;++m)D[m]=w();if("number"!==typeof a&&
a)if("object"===typeof a)if(b)t(D[0],a),t(D[1],b),t(D[2],d),t(D[3],e),t(D[4],f),t(D[5],g);else if(ia(na,a),k(B,a),"faces"in a)for(a=a.faces,p(Array.isArray(a)&&6===a.length,"cube faces must be a length 6 array"),m=0;6>m;++m)p("object"===typeof a[m]&&!!a[m],"invalid input for cube map face"),r(D[m],B),t(D[m],a[m]);else for(m=0;6>m;++m)t(D[m],a);else p.raise("invalid arguments to cube map");else for(a=a|0||1,m=0;6>m;++m)x(D[m],a,a);r(B,D[0]);B.mipmask=na.genMipmaps?(D[0].width<<1)-1:D[0].mipmask;p.textureCube(B,
na,D,c);B.internalformat=D[0].internalformat;v.width=D[0].width;v.height=D[0].height;da(B);for(m=0;6>m;++m)y(D[m],34069+m);A(na,34067);ea();h.profile&&(B.stats.size=Ua(B.internalformat,B.type,v.width,v.height,na.genMipmaps,!0));v.format=C[B.internalformat];v.type=I[B.type];v.mag=Na[na.magFilter];v.min=xa[na.minFilter];v.wrapS=ya[na.wrapS];v.wrapT=ya[na.wrapT];for(m=0;6>m;++m)pa(D[m]);return v}var B=new cb(34067);V[B.id]=B;f.cubeCount++;var D=Array(6);v(b,d,e,g,m,n);v.subimage=function(a,b,c,d,e){p(!!b,
"must specify image data");p("number"===typeof a&&a===(a|0)&&0<=a&&6>a,"invalid face");c|=0;d|=0;e|=0;var f=u();r(f,B);f.width=0;f.height=0;l(f,b);f.width=f.width||(B.width>>e)-c;f.height=f.height||(B.height>>e)-d;p(B.type===f.type&&B.format===f.format&&B.internalformat===f.internalformat,"incompatible format for texture.subimage");p(0<=c&&0<=d&&c+f.width<=B.width&&d+f.height<=B.height,"texture.subimage write out of bounds");p(B.mipmask&1<<e,"missing mipmap data");p(f.data||f.element||f.needsCopy,
"missing image data");da(B);q(f,34069+a,c,d,e);ea();aa(f);return v};v.resize=function(b){b|=0;if(b!==B.width){v.width=B.width=b;v.height=B.height=b;da(B);for(var c=0;6>c;++c)for(var d=0;B.mipmask>>d;++d)a.texImage2D(34069+c,d,B.format,b>>d,b>>d,0,B.format,B.type,null);ea();h.profile&&(B.stats.size=Ua(B.internalformat,B.type,v.width,v.height,!1,!0));return v}};v._reglType="textureCube";v._texture=B;h.profile&&(v.stats=B.stats);v.destroy=function(){B.decRef()};return v},clear:function(){for(var b=0;b<
F;++b)a.activeTexture(33984+b),a.bindTexture(3553,null),Q[b]=null;ja(V).forEach(vb);f.cubeCount=0;f.textureCount=0},getTexture:function(a){return null},restore:function(){ja(V).forEach(function(b){b.texture=a.createTexture();a.bindTexture(b.target,b.texture);for(var c=0;32>c;++c)if(0!==(b.mipmask&1<<c))if(3553===b.target)a.texImage2D(3553,c,b.internalformat,b.width>>c,b.height>>c,0,b.internalformat,b.type,null);else for(var d=0;6>d;++d)a.texImage2D(34069+d,c,b.internalformat,b.width>>c,b.height>>
c,0,b.internalformat,b.type,null);A(b.texInfo,b.target)})}}}function Nb(a,b,c,d,f,e){function h(a,b,c){this.target=a;this.texture=b;this.renderbuffer=c;var d=a=0;b?(a=b.width,d=b.height):c&&(a=c.width,d=c.height);this.width=a;this.height=d}function g(a){a&&(a.texture&&a.texture._texture.decRef(),a.renderbuffer&&a.renderbuffer._renderbuffer.decRef())}function m(a,b,c){if(a){if(a.texture){a=a.texture._texture;var d=Math.max(1,a.height);p(Math.max(1,a.width)===b&&d===c,"inconsistent width/height for supplied texture")}else a=
a.renderbuffer._renderbuffer,p(a.width===b&&a.height===c,"inconsistent width/height for renderbuffer");a.refCount+=1}}function r(b,c){c&&(c.texture?a.framebufferTexture2D(36160,b,c.target,c.texture._texture.texture,0):a.framebufferRenderbuffer(36160,b,36161,c.renderbuffer._renderbuffer.renderbuffer))}function k(a){var b=3553,c=null,d=null,f=a;"object"===typeof a&&(f=a.data,"target"in a&&(b=a.target|0));p.type(f,"function","invalid attachment data");a=f._reglType;"texture2d"===a?(c=f,p(3553===b)):
"textureCube"===a?(c=f,p(34069<=b&&34075>b,"invalid cube map target")):"renderbuffer"===a?(d=f,b=36161):p.raise("invalid regl object for attachment");return new h(b,c,d)}function n(a,b,c,e,g){if(c)return a=d.create2D({width:a,height:b,format:e,type:g}),a._texture.refCount=0,new h(3553,a,null);a=f.create({width:a,height:b,format:e});a._renderbuffer.refCount=0;return new h(36161,null,a)}function l(a){return a&&(a.texture||a.renderbuffer)}function q(a,b,c){a&&(a.texture?a.texture.resize(b,c):a.renderbuffer&&
a.renderbuffer.resize(b,c))}function v(){this.id=ia++;A[this.id]=this;this.framebuffer=a.createFramebuffer();this.height=this.width=0;this.colorAttachments=[];this.depthStencilAttachment=this.stencilAttachment=this.depthAttachment=null}function u(a){a.colorAttachments.forEach(g);g(a.depthAttachment);g(a.stencilAttachment);g(a.depthStencilAttachment)}function t(b){var c=b.framebuffer;p(c,"must not double destroy framebuffer");a.deleteFramebuffer(c);b.framebuffer=null;e.framebufferCount--;delete A[b.id]}
function x(b){var d;a.bindFramebuffer(36160,b.framebuffer);var f=b.colorAttachments;for(d=0;d<f.length;++d)r(36064+d,f[d]);for(d=f.length;d<c.maxColorAttachments;++d)a.framebufferTexture2D(36160,36064+d,3553,null,0);a.framebufferTexture2D(36160,33306,3553,null,0);a.framebufferTexture2D(36160,36096,3553,null,0);a.framebufferTexture2D(36160,36128,3553,null,0);r(36096,b.depthAttachment);r(36128,b.stencilAttachment);r(33306,b.depthStencilAttachment);b=a.checkFramebufferStatus(36160);36053!==b&&p.raise("framebuffer configuration not supported, status = "+
Ob[b]);a.bindFramebuffer(36160,y.next);y.cur=y.next;a.getError()}function aa(a,d){function f(a,d){p(y.next!==h,"can not update framebuffer which is currently in use");var e=b.webgl_draw_buffers,g=0,r=0,q=!0,v=!0;var t=null;var aa=!0,B="rgba",A="uint8",ia=1,va=null,ma=null,da=null,Sa=!1;if("number"===typeof a)g=a|0,r=d|0||g;else if(a){p.type(a,"object","invalid arguments for framebuffer");"shape"in a?(r=a.shape,p(Array.isArray(r)&&2<=r.length,"invalid shape for framebuffer"),g=r[0],r=r[1]):("radius"in
a&&(g=r=a.radius),"width"in a&&(g=a.width),"height"in a&&(r=a.height));if("color"in a||"colors"in a)t=a.color||a.colors,Array.isArray(t)&&p(1===t.length||e,"multiple render targets not supported");if(!t){"colorCount"in a&&(ia=a.colorCount|0,p(0<ia,"invalid color buffer count"));"colorTexture"in a&&(aa=!!a.colorTexture,B="rgba4");if("colorType"in a){A=a.colorType;if(aa)p(b.oes_texture_float||!("float"===A||"float32"===A),"you must enable OES_texture_float in order to use floating point framebuffer objects"),
p(b.oes_texture_half_float||!("half float"===A||"float16"===A),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects");else if("half float"===A||"float16"===A)p(b.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),B="rgba16f";else if("float"===A||"float32"===A)p(b.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),B="rgba32f";p.oneOf(A,
pa,"invalid color type")}if("colorFormat"in a)if(B=a.colorFormat,0<=w.indexOf(B))aa=!0;else if(0<=z.indexOf(B))aa=!1;else if(aa)p.oneOf(a.colorFormat,w,"invalid color format for texture");else p.oneOf(a.colorFormat,z,"invalid color format for renderbuffer")}if("depthTexture"in a||"depthStencilTexture"in a)Sa=!(!a.depthTexture&&!a.depthStencilTexture),p(!Sa||b.webgl_depth_texture,"webgl_depth_texture extension not supported");"depth"in a&&("boolean"===typeof a.depth?q=a.depth:(va=a.depth,v=!1));"stencil"in
a&&("boolean"===typeof a.stencil?v=a.stencil:(ma=a.stencil,q=!1));"depthStencil"in a&&("boolean"===typeof a.depthStencil?q=v=a.depthStencil:(da=a.depthStencil,v=q=!1))}else g=r=1;d=e=a=null;if(Array.isArray(t))var S=t.map(k);else if(t)S=[k(t)];else for(S=Array(ia),t=0;t<ia;++t)S[t]=n(g,r,aa,B,A);p(b.webgl_draw_buffers||1>=S.length,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers.");p(S.length<=c.maxColorAttachments,"too many color attachments, not supported");
g=g||S[0].width;r=r||S[0].height;va?a=k(va):q&&!v&&(a=n(g,r,Sa,"depth","uint32"));ma?e=k(ma):v&&!q&&(e=n(g,r,!1,"stencil","uint8"));da?d=k(da):!va&&!ma&&v&&q&&(d=n(g,r,Sa,"depth stencil","depth stencil"));p(1>=!!va+!!ma+!!da,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");q=null;for(t=0;t<S.length;++t)m(S[t],g,r),p(!S[t]||S[t].texture&&0<=Pb.indexOf(S[t].texture._texture.format)||S[t].renderbuffer&&0<=Qb.indexOf(S[t].renderbuffer._renderbuffer.format),"framebuffer color attachment "+
t+" is invalid"),S[t]&&S[t].texture&&(v=wb[S[t].texture._texture.format]*Ya[S[t].texture._texture.type],null===q?q=v:p(q===v,"all color attachments much have the same number of bits per pixel."));m(a,g,r);p(!a||a.texture&&6402===a.texture._texture.format||a.renderbuffer&&33189===a.renderbuffer._renderbuffer.format,"invalid depth attachment for framebuffer object");m(e,g,r);p(!e||e.renderbuffer&&36168===e.renderbuffer._renderbuffer.format,"invalid stencil attachment for framebuffer object");m(d,g,
r);p(!d||d.texture&&34041===d.texture._texture.format||d.renderbuffer&&34041===d.renderbuffer._renderbuffer.format,"invalid depth-stencil attachment for framebuffer object");u(h);h.width=g;h.height=r;h.colorAttachments=S;h.depthAttachment=a;h.stencilAttachment=e;h.depthStencilAttachment=d;f.color=S.map(l);f.depth=l(a);f.stencil=l(e);f.depthStencil=l(d);f.width=h.width;f.height=h.height;x(h);return f}var h=new v;e.framebufferCount++;f(a,d);return N(f,{resize:function(a,b){p(y.next!==h,"can not resize a framebuffer which is currently in use");
a|=0;b=b|0||a;if(a===h.width&&b===h.height)return f;for(var c=h.colorAttachments,d=0;d<c.length;++d)q(c[d],a,b);q(h.depthAttachment,a,b);q(h.stencilAttachment,a,b);q(h.depthStencilAttachment,a,b);h.width=f.width=a;h.height=f.height=b;x(h);return f},_reglType:"framebuffer",_framebuffer:h,destroy:function(){t(h);u(h)},use:function(a){y.setFBO({framebuffer:f},a)}})}var y={cur:null,next:null,dirty:!1,setFBO:null},w=["rgba"],z=["rgba4","rgb565","rgb5 a1"];b.ext_srgb&&z.push("srgba");b.ext_color_buffer_half_float&&
z.push("rgba16f","rgb16f");b.webgl_color_buffer_float&&z.push("rgba32f");var pa=["uint8"];b.oes_texture_half_float&&pa.push("half float","float16");b.oes_texture_float&&pa.push("float","float32");var ia=0,A={};return N(y,{getFramebuffer:function(a){return"function"===typeof a&&"framebuffer"===a._reglType&&(a=a._framebuffer,a instanceof v)?a:null},create:aa,createCube:function(a){function f(a){p(0>e.indexOf(y.next),"can not update framebuffer which is currently in use");var c=b.webgl_draw_buffers,
h={color:null},g=0,r=null;var m="rgba";var k="uint8",n=1;if("number"===typeof a)g=a|0;else if(a){p.type(a,"object","invalid arguments for framebuffer");"shape"in a?(g=a.shape,p(Array.isArray(g)&&2<=g.length,"invalid shape for framebuffer"),p(g[0]===g[1],"cube framebuffer must be square"),g=g[0]):("radius"in a&&(g=a.radius|0),"width"in a?(g=a.width|0,"height"in a&&p(a.height===g,"must be square")):"height"in a&&(g=a.height|0));if("color"in a||"colors"in a)r=a.color||a.colors,Array.isArray(r)&&p(1===
r.length||c,"multiple render targets not supported");r||("colorCount"in a&&(n=a.colorCount|0,p(0<n,"invalid color buffer count")),"colorType"in a&&(p.oneOf(a.colorType,pa,"invalid color type"),k=a.colorType),"colorFormat"in a&&(m=a.colorFormat,p.oneOf(a.colorFormat,w,"invalid color format for texture")));"depth"in a&&(h.depth=a.depth);"stencil"in a&&(h.stencil=a.stencil);"depthStencil"in a&&(h.depthStencil=a.depthStencil)}else g=1;if(r)if(Array.isArray(r))for(a=[],m=0;m<r.length;++m)a[m]=r[m];else a=
[r];else for(a=Array(n),r={radius:g,format:m,type:k},m=0;m<n;++m)a[m]=d.createCube(r);h.color=Array(a.length);for(m=0;m<a.length;++m)n=a[m],p("function"===typeof n&&"textureCube"===n._reglType,"invalid cube map"),g=g||n.width,p(n.width===g&&n.height===g,"invalid cube map shape"),h.color[m]={target:34069,data:a[m]};for(m=0;6>m;++m){for(n=0;n<a.length;++n)h.color[n].target=34069+m;0<m&&(h.depth=e[0].depth,h.stencil=e[0].stencil,h.depthStencil=e[0].depthStencil);if(e[m])e[m](h);else e[m]=aa(h)}return N(f,
{width:g,height:g,color:a})}var e=Array(6);f(a);return N(f,{faces:e,resize:function(a){var b=a|0;p(0<b&&b<=c.maxCubeMapSize,"invalid radius for cube fbo");if(b===f.width)return f;var d=f.color;for(a=0;a<d.length;++a)d[a].resize(b);for(a=0;6>a;++a)e[a].resize(b);f.width=f.height=b;return f},_reglType:"framebufferCube",destroy:function(){e.forEach(function(a){a.destroy()})}})},clear:function(){ja(A).forEach(t)},restore:function(){ja(A).forEach(function(b){b.framebuffer=a.createFramebuffer();x(b)})}})}
function xb(){this.w=this.z=this.y=this.x=this.state=0;this.buffer=null;this.size=0;this.normalized=!1;this.type=5126;this.divisor=this.stride=this.offset=0}function Rb(a,b,c,d,f){a=c.maxAttributes;b=Array(a);for(c=0;c<a;++c)b[c]=new xb;return{Record:xb,scope:{},state:b}}function Sb(a,b,c,d){function f(a,b,c,d){this.name=a;this.id=b;this.location=c;this.info=d}function e(a,b){for(var c=0;c<a.length;++c)if(a[c].id===b.id){a[c].location=b.location;return}a.push(b)}function h(c,d,f){var e=35632===c?
r:k,h=e[d];if(!h){var g=b.str(d),h=a.createShader(c);a.shaderSource(h,g);a.compileShader(h);p.shaderError(a,h,g,c,f);e[d]=h}return h}function g(a,b){this.id=q++;this.fragId=a;this.vertId=b;this.program=null;this.uniforms=[];this.attributes=[];d.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function m(c,g){var m=h(35632,c.fragId);var r=h(35633,c.vertId),k=c.program=a.createProgram();a.attachShader(k,m);a.attachShader(k,r);a.linkProgram(k);p.linkError(a,k,b.str(c.fragId),b.str(c.vertId),
g);r=a.getProgramParameter(k,35718);d.profile&&(c.stats.uniformsCount=r);var n=c.uniforms;for(g=0;g<r;++g)if(m=a.getActiveUniform(k,g))if(1<m.size)for(var l=0;l<m.size;++l){var q=m.name.replace("[0]","["+l+"]");e(n,new f(q,b.id(q),a.getUniformLocation(k,q),m))}else e(n,new f(m.name,b.id(m.name),a.getUniformLocation(k,m.name),m));r=a.getProgramParameter(k,35721);d.profile&&(c.stats.attributesCount=r);c=c.attributes;for(g=0;g<r;++g)(m=a.getActiveAttrib(k,g))&&e(c,new f(m.name,b.id(m.name),a.getAttribLocation(k,
m.name),m))}var r={},k={},n={},l=[],q=0;d.profile&&(c.getMaxUniformsCount=function(){var a=0;l.forEach(function(b){b.stats.uniformsCount>a&&(a=b.stats.uniformsCount)});return a},c.getMaxAttributesCount=function(){var a=0;l.forEach(function(b){b.stats.attributesCount>a&&(a=b.stats.attributesCount)});return a});return{clear:function(){var b=a.deleteShader.bind(a);ja(r).forEach(b);r={};ja(k).forEach(b);k={};l.forEach(function(b){a.deleteProgram(b.program)});l.length=0;n={};c.shaderCount=0},program:function(a,
b,d){p.command(0<=a,"missing vertex shader",d);p.command(0<=b,"missing fragment shader",d);var f=n[b];f||(f=n[b]={});var e=f[a];e||(e=new g(b,a),c.shaderCount++,m(e,d),f[a]=e,l.push(e));return e},restore:function(){r={};k={};for(var a=0;a<l.length;++a)m(l[a])},shader:h,frag:-1,vert:-1}}function Tb(a,b,c,d,f,e){function h(h){if(null===b.next){p(f.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer');var g=5121}else p(null!==
b.next.colorAttachments[0].texture,"You cannot read from a renderbuffer"),g=b.next.colorAttachments[0].texture._texture.type,e.oes_texture_float?p(5121===g||5126===g,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"):p(5121===g,"Reading from a framebuffer is only allowed for the type 'uint8'");var m=0,r=0,k=d.framebufferWidth,n=d.framebufferHeight,l=null;E(h)?l=h:h&&(p.type(h,"object","invalid arguments to regl.read()"),m=h.x|0,r=h.y|0,p(0<=m&&m<d.framebufferWidth,"invalid x offset for regl.read"),
p(0<=r&&r<d.framebufferHeight,"invalid y offset for regl.read"),k=(h.width||d.framebufferWidth-m)|0,n=(h.height||d.framebufferHeight-r)|0,l=h.data||null);l&&(5121===g?p(l instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):5126===g&&p(l instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'"));p(0<k&&k+m<=d.framebufferWidth,"invalid width for read pixels");p(0<n&&n+r<=d.framebufferHeight,"invalid height for read pixels");
c();h=k*n*4;l||(5121===g?l=new Uint8Array(h):5126===g&&(l=l||new Float32Array(h)));p.isTypedArray(l,"data buffer for regl.read() must be a typedarray");p(l.byteLength>=h,"data buffer for regl.read() too small");a.pixelStorei(3333,4);a.readPixels(m,r,k,n,6408,g,l);return l}function g(a){var c;b.setFBO({framebuffer:a.framebuffer},function(){c=h(a)});return c}return function(a){return a&&"framebuffer"in a?g(a):h(a)}}function Ca(a){return Array.prototype.slice.call(a)}function Da(a){return Ca(a).join("")}
function Ub(){function a(){var a=[],b=[];return N(function(){a.push.apply(a,Ca(arguments))},{def:function(){var d="v"+c++;b.push(d);0<arguments.length&&(a.push(d,"="),a.push.apply(a,Ca(arguments)),a.push(";"));return d},toString:function(){return Da([0<b.length?"var "+b+";":"",Da(a)])}})}function b(){function b(a,b){d(a,b,"=",c.def(a,b),";")}var c=a(),d=a(),f=c.toString,e=d.toString;return N(function(){c.apply(c,Ca(arguments))},{def:c.def,entry:c,exit:d,save:b,set:function(a,d,f){b(a,d);c(a,d,"=",
f,";")},toString:function(){return f()+e()}})}var c=0,d=[],f=[],e=a(),h={};return{global:e,link:function(a){for(var b=0;b<f.length;++b)if(f[b]===a)return d[b];b="g"+c++;d.push(b);f.push(a);return b},block:a,proc:function(a,c){function d(){var a="a"+f.length;f.push(a);return a}var f=[];c=c||0;for(var e=0;e<c;++e)d();c=b();var g=c.toString;return h[a]=N(c,{arg:d,toString:function(){return Da(["function(",f.join(),"){",g(),"}"])}})},scope:b,cond:function(){var a=Da(arguments),c=b(),d=b(),f=c.toString,
e=d.toString;return N(c,{then:function(){c.apply(c,Ca(arguments));return this},else:function(){d.apply(d,Ca(arguments));return this},toString:function(){var b=e();b&&(b="else{"+b+"}");return Da(["if(",a,"){",f(),"}",b])}})},compile:function(){var a=['"use strict";',e,"return {"];Object.keys(h).forEach(function(b){a.push('"',b,'":',h[b].toString(),",")});a.push("}");var b=Da(a).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,d.concat(b)).apply(null,f)}}}function Za(a){return Array.isArray(a)||
E(a)||K(a)}function yb(a){return a.sort(function(a,b){return"viewport"===a?-1:"viewport"===b?1:a<b?-1:1})}function ca(a,b,c,d){this.thisDep=a;this.contextDep=b;this.propDep=c;this.append=d}function ta(a){return a&&!(a.thisDep||a.contextDep||a.propDep)}function I(a){return new ca(!1,!1,!1,a)}function Y(a,b){var c=a.type;return 0===c?(a=a.data.length,new ca(!0,1<=a,2<=a,b)):4===c?(a=a.data,new ca(a.thisDep,a.contextDep,a.propDep,b)):new ca(3===c,2===c,1===c,b)}function Vb(a,b,c,d,f,e,h,g,m,k,n,l,q,
v,t){function r(a){return a.replace(".","_")}function u(a,b,c){var d=r(a);La.push(a);Ka[d]=E[d]=!!c;ra[d]=b}function x(a,b,c){var d=r(a);La.push(a);Array.isArray(c)?(E[d]=c.slice(),Ka[d]=c.slice()):E[d]=Ka[d]=c;sa[d]=b}function y(){var a=Ub(),c=a.link,d=a.global;a.id=W++;a.batchId="0";var f=c(fa),e=a.shared={props:"a0"};Object.keys(fa).forEach(function(a){e[a]=d.def(f,".",a)});p.optional(function(){a.CHECK=c(p);a.commandStr=p.guessCommand();a.command=c(a.commandStr);a.assert=function(a,b,d){a("if(!(",
b,"))",this.CHECK,".commandRaise(",c(d),",",this.command,");")};T.invalidBlendCombinations=zb});var h=a.next={},g=a.current={};Object.keys(sa).forEach(function(a){Array.isArray(E[a])&&(h[a]=d.def(e.next,".",a),g[a]=d.def(e.current,".",a))});var m=a.constants={};Object.keys(T).forEach(function(a){m[a]=d.def(JSON.stringify(T[a]))});a.invoke=function(b,d){switch(d.type){case 0:var f=["this",e.context,e.props,a.batchId];return b.def(c(d.data),".call(",f.slice(0,Math.max(d.data.length+1,4)),")");case 1:return b.def(e.props,
d.data);case 2:return b.def(e.context,d.data);case 3:return b.def("this",d.data);case 4:return d.data.append(a,b),d.data.ref}};a.attribCache={};var r={};a.scopeAttrib=function(a){a=b.id(a);if(a in r)return r[a];var d=k.scope[a];d||(d=k.scope[a]=new G);return r[a]=c(d)};return a}function aa(a){var b=a.static;a=a.dynamic;if("profile"in b){var c=!!b.profile;var d=I(function(a,b){return c});d.enable=c}else if("profile"in a){var f=a.profile;d=Y(f,function(a,b){return a.invoke(b,f)})}return d}function w(a,
b){b=a.static;a=a.dynamic;if("framebuffer"in b){var c=b.framebuffer;return c?(c=g.getFramebuffer(c),p.command(c,"invalid framebuffer object"),I(function(a,b){var d=a.link(c);a=a.shared;b.set(a.framebuffer,".next",d);a=a.context;b.set(a,".framebufferWidth",d+".width");b.set(a,".framebufferHeight",d+".height");return d})):I(function(a,b){a=a.shared;b.set(a.framebuffer,".next","null");a=a.context;b.set(a,".framebufferWidth",a+".drawingBufferWidth");b.set(a,".framebufferHeight",a+".drawingBufferHeight");
return"null"})}if("framebuffer"in a){var d=a.framebuffer;return Y(d,function(a,b){var c=a.invoke(b,d),f=a.shared,e=f.framebuffer,h=b.def(e,".getFramebuffer(",c,")");p.optional(function(){a.assert(b,"!"+c+"||"+h,"invalid framebuffer object")});b.set(e,".next",h);f=f.context;b.set(f,".framebufferWidth",h+"?"+h+".width:"+f+".drawingBufferWidth");b.set(f,".framebufferHeight",h+"?"+h+".height:"+f+".drawingBufferHeight");return h})}return null}function z(a,b,c){function d(a){if(a in f){var d=f[a];p.commandType(d,
"object","invalid "+a,c.commandStr);var h=!0,g=d.x|0,m=d.y|0;if("width"in d){var k=d.width|0;p.command(0<=k,"invalid "+a,c.commandStr)}else h=!1;if("height"in d){var r=d.height|0;p.command(0<=r,"invalid "+a,c.commandStr)}else h=!1;return new ca(!h&&b&&b.thisDep,!h&&b&&b.contextDep,!h&&b&&b.propDep,function(a,b){a=a.shared.context;var c=k;"width"in d||(c=b.def(a,".","framebufferWidth","-",g));var f=r;"height"in d||(f=b.def(a,".","framebufferHeight","-",m));return[g,m,c,f]})}if(a in e){var n=e[a],h=
Y(n,function(b,c){var d=b.invoke(c,n);p.optional(function(){b.assert(c,d+"&&typeof "+d+'==="object"',"invalid "+a)});var f=b.shared.context,e=c.def(d,".x|0"),h=c.def(d,".y|0"),g=c.def('"width" in ',d,"?",d,".width|0:","(",f,".","framebufferWidth","-",e,")"),m=c.def('"height" in ',d,"?",d,".height|0:","(",f,".","framebufferHeight","-",h,")");p.optional(function(){b.assert(c,g+">=0&&"+m+">=0","invalid "+a)});return[e,h,g,m]});b&&(h.thisDep=h.thisDep||b.thisDep,h.contextDep=h.contextDep||b.contextDep,
h.propDep=h.propDep||b.propDep);return h}return b?new ca(b.thisDep,b.contextDep,b.propDep,function(a,b){a=a.shared.context;return[0,0,b.def(a,".","framebufferWidth"),b.def(a,".","framebufferHeight")]}):null}var f=a.static,e=a.dynamic;if(a=d("viewport")){var h=a;a=new ca(a.thisDep,a.contextDep,a.propDep,function(a,b){var c=h.append(a,b);a=a.shared.context;b.set(a,".viewportWidth",c[2]);b.set(a,".viewportHeight",c[3]);return c})}return{viewport:a,scissor_box:d("scissor.box")}}function A(a){function c(a){if(a in
d){var c=b.id(d[a]);p.optional(function(){n.shader(Ab[a],c,p.guessCommand())});var e=I(function(){return c});e.id=c;return e}if(a in f){var h=f[a];return Y(h,function(b,c){var d=b.invoke(c,h),f=c.def(b.shared.strings,".id(",d,")");p.optional(function(){c(b.shared.shader,".shader(",Ab[a],",",f,",",b.command,");")});return f})}return null}var d=a.static,f=a.dynamic,e=c("frag"),h=c("vert"),g=null;ta(e)&&ta(h)?(g=n.program(h.id,e.id),a=I(function(a,b){return a.link(g)})):a=new ca(e&&e.thisDep||h&&h.thisDep,
e&&e.contextDep||h&&h.contextDep,e&&e.propDep||h&&h.propDep,function(a,b){var c=a.shared.shader;var d=e?e.append(a,b):b.def(c,".","frag");var f=h?h.append(a,b):b.def(c,".","vert");var g=c+".program("+f+","+d;p.optional(function(){g+=","+a.command});return b.def(g+")")});return{frag:e,vert:h,progVar:a,program:g}}function B(a,b){function c(a,c){if(a in d){var e=d[a]|0;p.command(!c||0<=e,"invalid "+a,b.commandStr);return I(function(a,b){c&&(a.OFFSET=e);return e})}if(a in f){var g=f[a];return Y(g,function(b,
d){var f=b.invoke(d,g);c&&(b.OFFSET=f,p.optional(function(){b.assert(d,f+">=0","invalid "+a)}));return f})}return c&&h?I(function(a,b){a.OFFSET="0";return 0}):null}var d=a.static,f=a.dynamic,h=function(){if("elements"in d){var a=d.elements;Za(a)?a=e.getElements(e.create(a,!0)):a&&(a=e.getElements(a),p.command(a,"invalid elements",b.commandStr));var c=I(function(b,c){return a?(c=b.link(a),b.ELEMENTS=c):b.ELEMENTS=null});c.value=a;return c}if("elements"in f){var h=f.elements;return Y(h,function(a,b){var c=
a.shared,d=c.isBufferArgs,c=c.elements,f=a.invoke(b,h),e=b.def("null"),d=b.def(d,"(",f,")"),g=a.cond(d).then(e,"=",c,".createStream(",f,");").else(e,"=",c,".getElements(",f,");");p.optional(function(){a.assert(g.else,"!"+f+"||"+e,"invalid elements")});b.entry(g);b.exit(a.cond(d).then(c,".destroyStream(",e,");"));return a.ELEMENTS=e})}return null}(),g=c("offset",!0);return{elements:h,primitive:function(){if("primitive"in d){var a=d.primitive;p.commandParameter(a,za,"invalid primitve",b.commandStr);
return I(function(b,c){return za[a]})}if("primitive"in f){var c=f.primitive;return Y(c,function(a,b){var d=a.constants.primTypes,f=a.invoke(b,c);p.optional(function(){a.assert(b,f+" in "+d,"invalid primitive, must be one of "+Object.keys(za))});return b.def(d,"[",f,"]")})}return h?ta(h)?h.value?I(function(a,b){return b.def(a.ELEMENTS,".primType")}):I(function(){return 4}):new ca(h.thisDep,h.contextDep,h.propDep,function(a,b){a=a.ELEMENTS;return b.def(a,"?",a,".primType:",4)}):null}(),count:function(){if("count"in
d){var a=d.count|0;p.command("number"===typeof a&&0<=a,"invalid vertex count",b.commandStr);return I(function(){return a})}if("count"in f){var c=f.count;return Y(c,function(a,b){var d=a.invoke(b,c);p.optional(function(){a.assert(b,"typeof "+d+'==="number"&&'+d+">=0&&"+d+"===("+d+"|0)","invalid vertex count")});return d})}if(h){if(ta(h)){if(h)return g?new ca(g.thisDep,g.contextDep,g.propDep,function(a,b){var c=b.def(a.ELEMENTS,".vertCount-",a.OFFSET);p.optional(function(){a.assert(b,c+">=0","invalid vertex offset/element buffer too small")});
return c}):I(function(a,b){return b.def(a.ELEMENTS,".vertCount")});var e=I(function(){return-1});p.optional(function(){e.MISSING=!0});return e}var m=new ca(h.thisDep||g.thisDep,h.contextDep||g.contextDep,h.propDep||g.propDep,function(a,b){var c=a.ELEMENTS;return a.OFFSET?b.def(c,"?",c,".vertCount-",a.OFFSET,":-1"):b.def(c,"?",c,".vertCount:-1")});p.optional(function(){m.DYNAMIC=!0});return m}return null}(),instances:c("instances",!1),offset:g}}function pa(a,b){var c=a.static,f=a.dynamic,e={};La.forEach(function(a){function h(b,
d){if(a in c){var h=b(c[a]);e[g]=I(function(){return h})}else if(a in f){var m=f[a];e[g]=Y(m,function(a,b){return d(a,b,a.invoke(b,m))})}}var g=r(a);switch(a){case "cull.enable":case "blend.enable":case "dither":case "stencil.enable":case "depth.enable":case "scissor.enable":case "polygonOffset.enable":case "sample.alpha":case "sample.enable":case "depth.mask":return h(function(c){p.commandType(c,"boolean",a,b.commandStr);return c},function(b,c,d){p.optional(function(){b.assert(c,"typeof "+d+'==="boolean"',
"invalid flag "+a,b.commandStr)});return d});case "depth.func":return h(function(c){p.commandParameter(c,Ea,"invalid "+a,b.commandStr);return Ea[c]},function(b,c,d){var f=b.constants.compareFuncs;p.optional(function(){b.assert(c,d+" in "+f,"invalid "+a+", must be one of "+Object.keys(Ea))});return c.def(f,"[",d,"]")});case "depth.range":return h(function(a){p.command(H(a)&&2===a.length&&"number"===typeof a[0]&&"number"===typeof a[1]&&a[0]<=a[1],"depth range is 2d array",b.commandStr);return a},function(a,
b,c){p.optional(function(){a.assert(b,a.shared.isArrayLike+"("+c+")&&"+c+".length===2&&typeof "+c+'[0]==="number"&&typeof '+c+'[1]==="number"&&'+c+"[0]<="+c+"[1]","depth range must be a 2d array")});var d=b.def("+",c,"[0]"),f=b.def("+",c,"[1]");return[d,f]});case "blend.func":return h(function(a){p.commandType(a,"object","blend.func",b.commandStr);var c="srcRGB"in a?a.srcRGB:a.src,d="srcAlpha"in a?a.srcAlpha:a.src,f="dstRGB"in a?a.dstRGB:a.dst;a="dstAlpha"in a?a.dstAlpha:a.dst;p.commandParameter(c,
oa,g+".srcRGB",b.commandStr);p.commandParameter(d,oa,g+".srcAlpha",b.commandStr);p.commandParameter(f,oa,g+".dstRGB",b.commandStr);p.commandParameter(a,oa,g+".dstAlpha",b.commandStr);p.command(-1===zb.indexOf(c+", "+f),"unallowed blending combination (srcRGB, dstRGB) = ("+c+", "+f+")",b.commandStr);return[oa[c],oa[f],oa[d],oa[a]]},function(b,c,d){function f(f,h){var g=c.def('"',f,h,'" in ',d,"?",d,".",f,h,":",d,".",f);p.optional(function(){b.assert(c,g+" in "+e,"invalid "+a+"."+f+h+", must be one of "+
Object.keys(oa))});return g}var e=b.constants.blendFuncs;p.optional(function(){b.assert(c,d+"&&typeof "+d+'==="object"',"invalid blend func, must be an object")});var h=f("src","RGB"),g=f("dst","RGB");p.optional(function(){b.assert(c,b.constants.invalidBlendCombinations+".indexOf("+h+'+", "+'+g+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var m=c.def(e,"[",h,"]"),k=c.def(e,"[",f("src","Alpha"),"]"),r=c.def(e,"[",g,"]"),n=c.def(e,"[",f("dst","Alpha"),"]");return[m,r,k,n]});
case "blend.equation":return h(function(c){if("string"===typeof c)return p.commandParameter(c,V,"invalid "+a,b.commandStr),[V[c],V[c]];if("object"===typeof c)return p.commandParameter(c.rgb,V,a+".rgb",b.commandStr),p.commandParameter(c.alpha,V,a+".alpha",b.commandStr),[V[c.rgb],V[c.alpha]];p.commandRaise("invalid blend.equation",b.commandStr)},function(b,c,d){var f=b.constants.blendEquations,e=c.def(),h=c.def(),g=b.cond("typeof ",d,'==="string"');p.optional(function(){function c(a,c,d){b.assert(a,
d+" in "+f,"invalid "+c+", must be one of "+Object.keys(V))}c(g.then,a,d);b.assert(g.else,d+"&&typeof "+d+'==="object"',"invalid "+a);c(g.else,a+".rgb",d+".rgb");c(g.else,a+".alpha",d+".alpha")});g.then(e,"=",h,"=",f,"[",d,"];");g.else(e,"=",f,"[",d,".rgb];",h,"=",f,"[",d,".alpha];");c(g);return[e,h]});case "blend.color":return h(function(a){p.command(H(a)&&4===a.length,"blend.color must be a 4d array",b.commandStr);return R(4,function(b){return+a[b]})},function(a,b,c){p.optional(function(){a.assert(b,
a.shared.isArrayLike+"("+c+")&&"+c+".length===4","blend.color must be a 4d array")});return R(4,function(a){return b.def("+",c,"[",a,"]")})});case "stencil.mask":return h(function(a){p.commandType(a,"number",g,b.commandStr);return a|0},function(a,b,c){p.optional(function(){a.assert(b,"typeof "+c+'==="number"',"invalid stencil.mask")});return b.def(c,"|0")});case "stencil.func":return h(function(c){p.commandType(c,"object",g,b.commandStr);var d=c.cmp||"keep",f=c.ref||0;c="mask"in c?c.mask:-1;p.commandParameter(d,
Ea,a+".cmp",b.commandStr);p.commandType(f,"number",a+".ref",b.commandStr);p.commandType(c,"number",a+".mask",b.commandStr);return[Ea[d],f,c]},function(a,b,c){var d=a.constants.compareFuncs;p.optional(function(){function f(){a.assert(b,Array.prototype.join.call(arguments,""),"invalid stencil.func")}f(c+"&&typeof ",c,'==="object"');f('!("cmp" in ',c,")||(",c,".cmp in ",d,")")});var f=b.def('"cmp" in ',c,"?",d,"[",c,".cmp]",":",7680),e=b.def(c,".ref|0"),h=b.def('"mask" in ',c,"?",c,".mask|0:-1");return[f,
e,h]});case "stencil.opFront":case "stencil.opBack":return h(function(c){p.commandType(c,"object",g,b.commandStr);var d=c.fail||"keep",f=c.zfail||"keep";c=c.zpass||"keep";p.commandParameter(d,ua,a+".fail",b.commandStr);p.commandParameter(f,ua,a+".zfail",b.commandStr);p.commandParameter(c,ua,a+".zpass",b.commandStr);return["stencil.opBack"===a?1029:1028,ua[d],ua[f],ua[c]]},function(b,c,d){function f(f){p.optional(function(){b.assert(c,'!("'+f+'" in '+d+")||("+d+"."+f+" in "+e+")","invalid "+a+"."+
f+", must be one of "+Object.keys(ua))});return c.def('"',f,'" in ',d,"?",e,"[",d,".",f,"]:",7680)}var e=b.constants.stencilOps;p.optional(function(){b.assert(c,d+"&&typeof "+d+'==="object"',"invalid "+a)});return["stencil.opBack"===a?1029:1028,f("fail"),f("zfail"),f("zpass")]});case "polygonOffset.offset":return h(function(a){p.commandType(a,"object",g,b.commandStr);var c=a.factor|0;a=a.units|0;p.commandType(c,"number",g+".factor",b.commandStr);p.commandType(a,"number",g+".units",b.commandStr);return[c,
a]},function(b,c,d){p.optional(function(){b.assert(c,d+"&&typeof "+d+'==="object"',"invalid "+a)});var f=c.def(d,".factor|0"),e=c.def(d,".units|0");return[f,e]});case "cull.face":return h(function(a){var c=0;"front"===a?c=1028:"back"===a&&(c=1029);p.command(!!c,g,b.commandStr);return c},function(a,b,c){p.optional(function(){a.assert(b,c+'==="front"||'+c+'==="back"',"invalid cull.face")});return b.def(c,'==="front"?',1028,":",1029)});case "lineWidth":return h(function(a){p.command("number"===typeof a&&
a>=d.lineWidthDims[0]&&a<=d.lineWidthDims[1],"invalid line width, must positive number between "+d.lineWidthDims[0]+" and "+d.lineWidthDims[1],b.commandStr);return a},function(a,b,c){p.optional(function(){a.assert(b,"typeof "+c+'==="number"&&'+c+">="+d.lineWidthDims[0]+"&&"+c+"<="+d.lineWidthDims[1],"invalid line width")});return c});case "frontFace":return h(function(a){p.commandParameter(a,db,g,b.commandStr);return db[a]},function(a,b,c){p.optional(function(){a.assert(b,c+'==="cw"||'+c+'==="ccw"',
"invalid frontFace, must be one of cw,ccw")});return b.def(c+'==="cw"?2304:2305')});case "colorMask":return h(function(a){p.command(H(a)&&4===a.length,"color.mask must be length 4 array",b.commandStr);return a.map(function(a){return!!a})},function(a,b,c){p.optional(function(){a.assert(b,a.shared.isArrayLike+"("+c+")&&"+c+".length===4","invalid color.mask")});return R(4,function(a){return"!!"+c+"["+a+"]"})});case "sample.coverage":return h(function(a){p.command("object"===typeof a&&a,g,b.commandStr);
var c="value"in a?a.value:1;a=!!a.invert;p.command("number"===typeof c&&0<=c&&1>=c,"sample.coverage.value must be a number between 0 and 1",b.commandStr);return[c,a]},function(a,b,c){p.optional(function(){a.assert(b,c+"&&typeof "+c+'==="object"',"invalid sample.coverage")});var d=b.def('"value" in ',c,"?+",c,".value:1"),f=b.def("!!",c,".invert");return[d,f]})}});return e}function va(a,b){var c=a.static,d=a.dynamic,f={};Object.keys(c).forEach(function(a){var d=c[a];if("number"===typeof d||"boolean"===
typeof d)var e=I(function(){return d});else if("function"===typeof d){var h=d._reglType;"texture2d"===h||"textureCube"===h?e=I(function(a){return a.link(d)}):"framebuffer"===h||"framebufferCube"===h?(p.command(0<d.color.length,'missing color attachment for framebuffer sent to uniform "'+a+'"',b.commandStr),e=I(function(a){return a.link(d.color[0])})):p.commandRaise('invalid data for uniform "'+a+'"',b.commandStr)}else H(d)?e=I(function(b){return b.global.def("[",R(d.length,function(c){p.command("number"===
typeof d[c]||"boolean"===typeof d[c],"invalid uniform "+a,b.commandStr);return d[c]}),"]")}):p.commandRaise('invalid or missing data for uniform "'+a+'"',b.commandStr);e.value=d;f[a]=e});Object.keys(d).forEach(function(a){var b=d[a];f[a]=Y(b,function(a,c){return a.invoke(c,b)})});return f}function ia(a,c){var d=a.static,e=a.dynamic,h={};Object.keys(d).forEach(function(a){var e=d[a],g=b.id(a),m=new G;if(Za(e))m.state=1,m.buffer=f.getBuffer(f.create(e,34962,!1,!0)),m.type=0;else{var k=f.getBuffer(e);
if(k)m.state=1,m.buffer=k,m.type=0;else if(p.command("object"===typeof e&&e,"invalid data for attribute "+a,c.commandStr),e.constant){var r=e.constant;m.buffer="null";m.state=2;"number"===typeof r?m.x=r:(p.command(H(r)&&0<r.length&&4>=r.length,"invalid constant for attribute "+a,c.commandStr),Fa.forEach(function(a,b){b<r.length&&(m[a]=r[b])}))}else{k=Za(e.buffer)?f.getBuffer(f.create(e.buffer,34962,!1,!0)):f.getBuffer(e.buffer);p.command(!!k,'missing buffer for attribute "'+a+'"',c.commandStr);var n=
e.offset|0;p.command(0<=n,'invalid offset for attribute "'+a+'"',c.commandStr);var l=e.stride|0;p.command(0<=l&&256>l,'invalid stride for attribute "'+a+'", must be integer betweeen [0, 255]',c.commandStr);var q=e.size|0;p.command(!("size"in e)||0<q&&4>=q,'invalid size for attribute "'+a+'", must be 1,2,3,4',c.commandStr);var D=!!e.normalized,v=0;"type"in e&&(p.commandParameter(e.type,Ja,"invalid type for attribute "+a,c.commandStr),v=Ja[e.type]);var t=e.divisor|0;"divisor"in e&&(p.command(0===t||
K,'cannot specify divisor for attribute "'+a+'", instancing not supported',c.commandStr),p.command(0<=t,'invalid divisor for attribute "'+a+'"',c.commandStr));p.optional(function(){var b=c.commandStr,d="buffer offset divisor normalized type size stride".split(" ");Object.keys(e).forEach(function(c){p.command(0<=d.indexOf(c),'unknown parameter "'+c+'" for attribute pointer "'+a+'" (valid parameters are '+d+")",b)})});m.buffer=k;m.state=1;m.size=q;m.normalized=D;m.type=v||k.dtype;m.offset=n;m.stride=
l;m.divisor=t}}h[a]=I(function(a,b){b=a.attribCache;if(g in b)return b[g];var c={isStream:!1};Object.keys(m).forEach(function(a){c[a]=m[a]});m.buffer&&(c.buffer=a.link(m.buffer),c.type=c.type||c.buffer+".dtype");return b[g]=c})});Object.keys(e).forEach(function(a){var b=e[a];h[a]=Y(b,function(c,d){function f(a){d(k[a],"=",e,".",a,"|0;")}var e=c.invoke(d,b),h=c.shared,g=h.isBufferArgs,m=h.buffer;p.optional(function(){c.assert(d,e+"&&(typeof "+e+'==="object"||typeof '+e+'==="function")&&('+g+"("+e+
")||"+m+".getBuffer("+e+")||"+m+".getBuffer("+e+".buffer)||"+g+"("+e+'.buffer)||("constant" in '+e+"&&(typeof "+e+'.constant==="number"||'+h.isArrayLike+"("+e+".constant))))",'invalid dynamic attribute "'+a+'"')});var k={isStream:d.def(!1)},r=new G;r.state=1;Object.keys(r).forEach(function(a){k[a]=d.def(""+r[a])});var n=k.buffer,l=k.type;d("if(",g,"(",e,")){",k.isStream,"=true;",n,"=",m,".createStream(",34962,",",e,");",l,"=",n,".dtype;","}else{",n,"=",m,".getBuffer(",e,");","if(",n,"){",l,"=",n,
".dtype;",'}else if("constant" in ',e,"){",k.state,"=",2,";","if(typeof "+e+'.constant === "number"){',k[Fa[0]],"=",e,".constant;",Fa.slice(1).map(function(a){return k[a]}).join("="),"=0;","}else{",Fa.map(function(a,b){return k[a]+"="+e+".constant.length>="+b+"?"+e+".constant["+b+"]:0;"}).join(""),"}}else{","if(",g,"(",e,".buffer)){",n,"=",m,".createStream(",34962,",",e,".buffer);","}else{",n,"=",m,".getBuffer(",e,".buffer);","}",l,'="type" in ',e,"?",h.glTypes,"[",e,".type]:",n,".dtype;",k.normalized,
"=!!",e,".normalized;");f("size");f("offset");f("stride");f("divisor");d("}}");d.exit("if(",k.isStream,"){",m,".destroyStream(",n,");","}");return k})});return h}function da(a){var b=a.static,c=a.dynamic,d={};Object.keys(b).forEach(function(a){var c=b[a];d[a]=I(function(a,b){return"number"===typeof c||"boolean"===typeof c?""+c:a.link(c)})});Object.keys(c).forEach(function(a){var b=c[a];d[a]=Y(b,function(a,c){return a.invoke(c,b)})});return d}function S(a,b,c,d,f){function e(a){var b=k[a];b&&(l[a]=
b)}var h=a.static,g=a.dynamic;p.optional(function(){function a(a){Object.keys(a).forEach(function(a){p.command(0<=b.indexOf(a),'unknown parameter "'+a+'"',f.commandStr)})}var b="framebuffer vert frag elements primitive offset count instances profile".split(" ").concat(La);a(h);a(g)});var m=w(a,f),k=z(a,m,f),n=B(a,f),l=pa(a,f),q=A(a,f);e("viewport");e(r("scissor.box"));var D=0<Object.keys(l).length,m={framebuffer:m,draw:n,shader:q,state:l,dirty:D};m.profile=aa(a,f);m.uniforms=va(c,f);m.attributes=
ia(b,f);m.context=da(d,f);return m}function Ra(a,b,c){var d=a.shared.context,f=a.scope();Object.keys(c).forEach(function(e){b.save(d,"."+e);f(d,".",e,"=",c[e].append(a,b),";")});b(f)}function ea(a,b,c,d){var f=a.shared,e=f.gl,h=f.framebuffer,g;L&&(g=b.def(f.extensions,".webgl_draw_buffers"));var m=a.constants,f=m.drawBuffer,m=m.backBuffer;a=c?c.append(a,b):b.def(h,".next");d||b("if(",a,"!==",h,".cur){");b("if(",a,"){",e,".bindFramebuffer(",36160,",",a,".framebuffer);");L&&b(g,".drawBuffersWEBGL(",
f,"[",a,".colorAttachments.length]);");b("}else{",e,".bindFramebuffer(",36160,",null);");L&&b(g,".drawBuffersWEBGL(",m,");");b("}",h,".cur=",a,";");d||b("}")}function kb(a,b,c){var d=a.shared,f=d.gl,e=a.current,h=a.next,g=d.current,m=d.next,k=a.cond(g,".dirty");La.forEach(function(b){b=r(b);if(!(b in c.state))if(b in h){var d=h[b];var n=e[b];var p=R(E[b].length,function(a){return k.def(d,"[",a,"]")});k(a.cond(p.map(function(a,b){return a+"!=="+n+"["+b+"]"}).join("||")).then(f,".",sa[b],"(",p,");",
p.map(function(a,b){return n+"["+b+"]="+a}).join(";"),";"))}else d=k.def(m,".",b),p=a.cond(d,"!==",g,".",b),k(p),b in ra?p(a.cond(d).then(f,".enable(",ra[b],");").else(f,".disable(",ra[b],");"),g,".",b,"=",d,";"):p(f,".",sa[b],"(",d,");",g,".",b,"=",d,";")});0===Object.keys(c.state).length&&k(g,".dirty=false;");b(k)}function ba(a,b,c,d){var f=a.shared,e=a.current,h=f.current,g=f.gl;yb(Object.keys(c)).forEach(function(f){var m=c[f];if(!d||d(m)){var k=m.append(a,b);if(ra[f]){var r=ra[f];ta(m)?k?b(g,
".enable(",r,");"):b(g,".disable(",r,");"):b(a.cond(k).then(g,".enable(",r,");").else(g,".disable(",r,");"));b(h,".",f,"=",k,";")}else if(H(k)){var n=e[f];b(g,".",sa[f],"(",k,");",k.map(function(a,b){return n+"["+b+"]="+a}).join(";"),";")}else b(g,".",sa[f],"(",k,");",h,".",f,"=",k,";")}})}function P(a,b){K&&(a.instancing=b.def(a.shared.extensions,".angle_instanced_arrays"))}function Pa(a,b,c,d,f){function e(){return"undefined"===typeof performance?"Date.now()":"performance.now()"}function h(a){l=
b.def();a(l,"=",e(),";");"string"===typeof f?a(r,".count+=",f,";"):a(r,".count++;");v&&(d?(q=b.def(),a(q,"=",p,".getNumPendingQueries();")):a(p,".beginQuery(",r,");"))}function g(a){a(r,".cpuTime+=",e(),"-",l,";");v&&(d?a(p,".pushScopeStats(",q,",",p,".getNumPendingQueries(),",r,");"):a(p,".endQuery();"))}function m(a){var c=b.def(n,".profile");b(n,".profile=",a,";");b.exit(n,".profile=",c,";")}var k=a.shared,r=a.stats,n=k.current,p=k.timer;c=c.profile;var l,q;if(c){if(ta(c)){c.enable?(h(b),g(b.exit),
m("true")):m("false");return}c=c.append(a,b);m(c)}else c=b.def(n,".profile");k=a.block();h(k);b("if(",c,"){",k,"}");a=a.block();g(a);b.exit("if(",c,"){",a,"}")}function J(a,b,c,d,f){function e(a){switch(a){case 35664:case 35667:case 35671:return 2;case 35665:case 35668:case 35672:return 3;case 35666:case 35669:case 35673:return 4;default:return 1}}function h(c,d,f){function e(){b("if(!",r,".buffer){",m,".enableVertexAttribArray(",k,");}");var c=f.type;var e=f.size?b.def(f.size,"||",d):d;b("if(",r,
".type!==",c,"||",r,".size!==",e,"||",l.map(function(a){return r+"."+a+"!=="+f[a]}).join("||"),"){",m,".bindBuffer(",34962,",",n,".buffer);",m,".vertexAttribPointer(",[k,e,c,f.normalized,f.stride,f.offset],");",r,".type=",c,";",r,".size=",e,";",l.map(function(a){return r+"."+a+"="+f[a]+";"}).join(""),"}");K&&(c=f.divisor,b("if(",r,".divisor!==",c,"){",a.instancing,".vertexAttribDivisorANGLE(",[k,c],");",r,".divisor=",c,";}"))}function h(){b("if(",r,".buffer){",m,".disableVertexAttribArray(",k,");",
"}if(",Fa.map(function(a,b){return r+"."+a+"!=="+p[b]}).join("||"),"){",m,".vertexAttrib4f(",k,",",p,");",Fa.map(function(a,b){return r+"."+a+"="+p[b]+";"}).join(""),"}")}var m=g.gl,k=b.def(c,".location"),r=b.def(g.attributes,"[",k,"]");c=f.state;var n=f.buffer,p=[f.x,f.y,f.z,f.w],l=["buffer","normalized","offset","stride"];1===c?e():2===c?h():(b("if(",c,"===",1,"){"),e(),b("}else{"),h(),b("}"))}var g=a.shared;d.forEach(function(d){var g=d.name,m=c.attributes[g];if(m){if(!f(m))return;var k=m.append(a,
b)}else{if(!f(Bb))return;var r=a.scopeAttrib(g);p.optional(function(){a.assert(b,r+".state","missing attribute "+g)});k={};Object.keys(new G).forEach(function(a){k[a]=b.def(r,".",a)})}h(a.link(d),e(d.info.type),k)})}function Qa(a,c,d,f,e){for(var h=a.shared,g=h.gl,m,k=0;k<f.length;++k){var r=f[k],n=r.name,l=r.info.type,q=d.uniforms[n],r=a.link(r)+".location";if(q){if(!e(q))continue;if(ta(q)){var v=q.value;p.command(null!==v&&"undefined"!==typeof v,'missing uniform "'+n+'"',a.commandStr);if(35678===
l||35680===l)p.command("function"===typeof v&&(35678===l&&("texture2d"===v._reglType||"framebuffer"===v._reglType)||35680===l&&("textureCube"===v._reglType||"framebufferCube"===v._reglType)),"invalid texture for uniform "+n,a.commandStr),q=a.link(v._texture||v.color[0]._texture),c(g,".uniform1i(",r,",",q+".bind());"),c.exit(q,".unbind();");else if(35674===l||35675===l||35676===l){p.optional(function(){p.command(H(v),"invalid matrix for uniform "+n,a.commandStr);p.command(35674===l&&4===v.length||
35675===l&&9===v.length||35676===l&&16===v.length,"invalid length for matrix uniform "+n,a.commandStr)});var q=a.global.def("new Float32Array(["+Array.prototype.slice.call(v)+"])"),t=2;35675===l?t=3:35676===l&&(t=4);c(g,".uniformMatrix",t,"fv(",r,",false,",q,");")}else{switch(l){case 5126:p.commandType(v,"number","uniform "+n,a.commandStr);m="1f";break;case 35664:p.command(H(v)&&2===v.length,"uniform "+n,a.commandStr);m="2f";break;case 35665:p.command(H(v)&&3===v.length,"uniform "+n,a.commandStr);
m="3f";break;case 35666:p.command(H(v)&&4===v.length,"uniform "+n,a.commandStr);m="4f";break;case 35670:p.commandType(v,"boolean","uniform "+n,a.commandStr);m="1i";break;case 5124:p.commandType(v,"number","uniform "+n,a.commandStr);m="1i";break;case 35671:p.command(H(v)&&2===v.length,"uniform "+n,a.commandStr);m="2i";break;case 35667:p.command(H(v)&&2===v.length,"uniform "+n,a.commandStr);m="2i";break;case 35672:p.command(H(v)&&3===v.length,"uniform "+n,a.commandStr);m="3i";break;case 35668:p.command(H(v)&&
3===v.length,"uniform "+n,a.commandStr);m="3i";break;case 35673:p.command(H(v)&&4===v.length,"uniform "+n,a.commandStr);m="4i";break;case 35669:p.command(H(v)&&4===v.length,"uniform "+n,a.commandStr),m="4i"}c(g,".uniform",m,"(",r,",",H(v)?Array.prototype.slice.call(v):v,");")}continue}else var u=q.append(a,c)}else{if(!e(Bb))continue;u=c.def(h.uniforms,"[",b.id(n),"]")}35678===l?c("if(",u,"&&",u,'._reglType==="framebuffer"){',u,"=",u,".color[0];","}"):35680===l&&c("if(",u,"&&",u,'._reglType==="framebufferCube"){',
u,"=",u,".color[0];","}");p.optional(function(){function b(b,d){a.assert(c,b,'bad data or missing for uniform "'+n+'".  '+d)}function d(a){b("typeof "+u+'==="'+a+'"',"invalid type, expected "+a)}function f(c,d){b(h.isArrayLike+"("+u+")&&"+u+".length==="+c,"invalid vector, should have length "+c,a.commandStr)}function e(c){b("typeof "+u+'==="function"&&'+u+'._reglType==="texture'+(3553===c?"2d":"Cube")+'"',"invalid texture type",a.commandStr)}switch(l){case 5124:d("number");break;case 35667:f(2,"number");
break;case 35668:f(3,"number");break;case 35669:f(4,"number");break;case 5126:d("number");break;case 35664:f(2,"number");break;case 35665:f(3,"number");break;case 35666:f(4,"number");break;case 35670:d("boolean");break;case 35671:f(2,"boolean");break;case 35672:f(3,"boolean");break;case 35673:f(4,"boolean");break;case 35674:f(4,"number");break;case 35675:f(9,"number");break;case 35676:f(16,"number");break;case 35678:e(3553);break;case 35680:e(34067)}});q=1;switch(l){case 35678:case 35680:q=c.def(u,
"._texture");c(g,".uniform1i(",r,",",q,".bind());");c.exit(q,".unbind();");continue;case 5124:case 35670:m="1i";break;case 35667:case 35671:m="2i";q=2;break;case 35668:case 35672:m="3i";q=3;break;case 35669:case 35673:m="4i";q=4;break;case 5126:m="1f";break;case 35664:m="2f";q=2;break;case 35665:m="3f";q=3;break;case 35666:m="4f";q=4;break;case 35674:m="Matrix2fv";break;case 35675:m="Matrix3fv";break;case 35676:m="Matrix4fv"}c(g,".uniform",m,"(",r,",");if("M"===m.charAt(0)){var r=Math.pow(l-35674+
2,2),x=a.global.def("new Float32Array(",r,")");c("false,(Array.isArray(",u,")||",u," instanceof Float32Array)?",u,":(",R(r,function(a){return x+"["+a+"]="+u+"["+a+"]"}),",",x,")")}else 1<q?c(R(q,function(a){return u+"["+a+"]"})):c(u);c(");")}}function C(a,b,c,d){function f(f){var e=r[f];return e?e.contextDep&&d.contextDynamic||e.propDep?e.append(a,c):e.append(a,b):b.def(k,".",f)}function e(){function a(){c(t,".drawElementsInstancedANGLE(",[l,v,x,q+"<<(("+x+"-5121)>>1)",u],");")}function b(){c(t,".drawArraysInstancedANGLE(",
[l,q,v,u],");")}n?D?a():(c("if(",n,"){"),a(),c("}else{"),b(),c("}")):b()}function h(){function a(){c(m+".drawElements("+[l,v,x,q+"<<(("+x+"-5121)>>1)"]+");")}function b(){c(m+".drawArrays("+[l,q,v]+");")}n?D?a():(c("if(",n,"){"),a(),c("}else{"),b(),c("}")):b()}var g=a.shared,m=g.gl,k=g.draw,r=d.draw,n=function(){var f=r.elements,e=b;if(f){if(f.contextDep&&d.contextDynamic||f.propDep)e=c;f=f.append(a,e)}else f=e.def(k,".","elements");f&&e("if("+f+")"+m+".bindBuffer(34963,"+f+".buffer.buffer);");return f}(),
l=f("primitive"),q=f("offset"),v=function(){var f=r.count,e=b;if(f){if(f.contextDep&&d.contextDynamic||f.propDep)e=c;var h=f.append(a,e);p.optional(function(){f.MISSING&&a.assert(b,"false","missing vertex count");f.DYNAMIC&&a.assert(e,h+">=0","missing vertex count")})}else h=e.def(k,".","count"),p.optional(function(){a.assert(e,h+">=0","missing vertex count")});return h}();if("number"===typeof v){if(0===v)return}else c("if(",v,"){"),c.exit("}");if(K){var u=f("instances");var t=a.instancing}var x=
n+".type",D=r.elements&&ta(r.elements);K&&("number"!==typeof u||0<=u)?"string"===typeof u?(c("if(",u,">0){"),e(),c("}else if(",u,"<0){"),h(),c("}")):e():h()}function ma(a,b,c,d,f){var e=y();f=e.proc("body",f);p.optional(function(){e.commandStr=b.commandStr;e.command=e.link(b.commandStr)});K&&(e.instancing=f.def(e.shared.extensions,".angle_instanced_arrays"));a(e,f,c,d);return e.compile().body}function Q(a,b,c,d){P(a,b);J(a,b,c,d.attributes,function(){return!0});Qa(a,b,c,d.uniforms,function(){return!0});
C(a,b,b,c)}function N(a,b){var c=a.proc("draw",1);P(a,c);Ra(a,c,b.context);ea(a,c,b.framebuffer);kb(a,c,b);ba(a,c,b.state);Pa(a,c,b,!1,!0);var d=b.shader.progVar.append(a,c);c(a.shared.gl,".useProgram(",d,".program);");if(b.shader.program)Q(a,c,b,b.shader.program);else{var f=a.global.def("{}"),e=c.def(d,".id"),h=c.def(f,"[",e,"]");c(a.cond(h).then(h,".call(this,a0);").else(h,"=",f,"[",e,"]=",a.link(function(c){return ma(Q,a,b,c,1)}),"(",d,");",h,".call(this,a0);"))}0<Object.keys(b.state).length&&
c(a.shared.current,".dirty=true;")}function Na(a,b,c,d){function f(){return!0}a.batchId="a1";P(a,b);J(a,b,c,d.attributes,f);Qa(a,b,c,d.uniforms,f);C(a,b,b,c)}function xa(a,b,c,d){function f(a){return a.contextDep&&h||a.propDep}function e(a){return!f(a)}P(a,b);var h=c.contextDep,g=b.def(),m=b.def();a.shared.props=m;a.batchId=g;var k=a.scope(),r=a.scope();b(k.entry,"for(",g,"=0;",g,"<","a1",";++",g,"){",m,"=","a0","[",g,"];",r,"}",k.exit);c.needsContext&&Ra(a,r,c.context);c.needsFramebuffer&&ea(a,r,
c.framebuffer);ba(a,r,c.state,f);c.profile&&f(c.profile)&&Pa(a,r,c,!1,!0);d?(J(a,k,c,d.attributes,e),J(a,r,c,d.attributes,f),Qa(a,k,c,d.uniforms,e),Qa(a,r,c,d.uniforms,f),C(a,k,r,c)):(b=a.global.def("{}"),d=c.shader.progVar.append(a,r),m=r.def(d,".id"),k=r.def(b,"[",m,"]"),r(a.shared.gl,".useProgram(",d,".program);","if(!",k,"){",k,"=",b,"[",m,"]=",a.link(function(b){return ma(Na,a,c,b,2)}),"(",d,");}",k,".call(this,a0[",g,"],",g,");"))}function ya(a,b){function c(a){return a.contextDep&&f||a.propDep}
var d=a.proc("batch",2);a.batchId="0";P(a,d);var f=!1,e=!0;Object.keys(b.context).forEach(function(a){f=f||b.context[a].propDep});f||(Ra(a,d,b.context),e=!1);var h=b.framebuffer,g=!1;h?(h.propDep?f=g=!0:h.contextDep&&f&&(g=!0),g||ea(a,d,h)):ea(a,d,null);b.state.viewport&&b.state.viewport.propDep&&(f=!0);kb(a,d,b);ba(a,d,b.state,function(a){return!c(a)});b.profile&&c(b.profile)||Pa(a,d,b,!1,"a1");b.contextDep=f;b.needsContext=e;b.needsFramebuffer=g;e=b.shader.progVar;if(e.contextDep&&f||e.propDep)xa(a,
d,b,null);else if(e=e.append(a,d),d(a.shared.gl,".useProgram(",e,".program);"),b.shader.program)xa(a,d,b,b.shader.program);else{var h=a.global.def("{}"),g=d.def(e,".id"),m=d.def(h,"[",g,"]");d(a.cond(m).then(m,".call(this,a0,a1);").else(m,"=",h,"[",g,"]=",a.link(function(c){return ma(xa,a,b,c,2)}),"(",e,");",m,".call(this,a0,a1);"))}0<Object.keys(b.state).length&&d(a.shared.current,".dirty=true;")}function F(a,c){function d(b){var d=c.shader[b];d&&f.set(e.shader,"."+b,d.append(a,f))}var f=a.proc("scope",
3);a.batchId="a2";var e=a.shared,h=e.current;Ra(a,f,c.context);c.framebuffer&&c.framebuffer.append(a,f);yb(Object.keys(c.state)).forEach(function(b){var d=c.state[b].append(a,f);H(d)?d.forEach(function(c,d){f.set(a.next[b],"["+d+"]",c)}):f.set(e.next,"."+b,d)});Pa(a,f,c,!0,!0);["elements","offset","count","instances","primitive"].forEach(function(b){var d=c.draw[b];d&&f.set(e.draw,"."+b,""+d.append(a,f))});Object.keys(c.uniforms).forEach(function(d){f.set(e.uniforms,"["+b.id(d)+"]",c.uniforms[d].append(a,
f))});Object.keys(c.attributes).forEach(function(b){var d=c.attributes[b].append(a,f),e=a.scopeAttrib(b);Object.keys(new G).forEach(function(a){f.set(e,"."+a,d[a])})});d("vert");d("frag");0<Object.keys(c.state).length&&(f(h,".dirty=true;"),f.exit(h,".dirty=true;"));f("a1(",a.shared.context,",a0,",a.batchId,");")}function X(a){if("object"===typeof a&&!H(a)){for(var b=Object.keys(a),c=0;c<b.length;++c)if(la.isDynamic(a[b[c]]))return!0;return!1}}function M(a,b,c){var d=b.static[c];if(d&&X(d)){var f=
a.global,e=Object.keys(d),h=!1,g=!1,m=!1,k=a.global.def("{}");e.forEach(function(b){var c=d[b];if(la.isDynamic(c))"function"===typeof c&&(c=d[b]=la.unbox(c)),b=Y(c,null),h=h||b.thisDep,m=m||b.propDep,g=g||b.contextDep;else{f(k,".",b,"=");switch(typeof c){case "number":f(c);break;case "string":f('"',c,'"');break;case "object":Array.isArray(c)&&f("[",c.join(),"]");break;default:f(a.link(c))}f(";")}});b.dynamic[c]=new la.DynamicVariable(4,{thisDep:h,contextDep:g,propDep:m,ref:k,append:function(a,b){e.forEach(function(c){var f=
d[c];la.isDynamic(f)&&(f=a.invoke(b,f),b(k,".",c,"=",f,";"))})}});delete b.static[c]}}var G=k.Record,V={add:32774,subtract:32778,"reverse subtract":32779};c.ext_blend_minmax&&(V.min=32775,V.max=32776);var K=c.angle_instanced_arrays,L=c.webgl_draw_buffers,E={dirty:!0,profile:t.profile},Ka={},La=[],ra={},sa={};u("dither",3024);u("blend.enable",3042);x("blend.color","blendColor",[0,0,0,0]);x("blend.equation","blendEquationSeparate",[32774,32774]);x("blend.func","blendFuncSeparate",[1,0,1,0]);u("depth.enable",
2929,!0);x("depth.func","depthFunc",513);x("depth.range","depthRange",[0,1]);x("depth.mask","depthMask",!0);x("colorMask","colorMask",[!0,!0,!0,!0]);u("cull.enable",2884);x("cull.face","cullFace",1029);x("frontFace","frontFace",2305);x("lineWidth","lineWidth",1);u("polygonOffset.enable",32823);x("polygonOffset.offset","polygonOffset",[0,0]);u("sample.alpha",32926);u("sample.enable",32928);x("sample.coverage","sampleCoverage",[1,!1]);u("stencil.enable",2960);x("stencil.mask","stencilMask",-1);x("stencil.func",
"stencilFunc",[519,0,-1]);x("stencil.opFront","stencilOpSeparate",[1028,7680,7680,7680]);x("stencil.opBack","stencilOpSeparate",[1029,7680,7680,7680]);u("scissor.enable",3089);x("scissor.box","scissor",[0,0,a.drawingBufferWidth,a.drawingBufferHeight]);x("viewport","viewport",[0,0,a.drawingBufferWidth,a.drawingBufferHeight]);var fa={gl:a,context:q,strings:b,next:Ka,current:E,draw:l,elements:e,buffer:f,shader:n,attributes:k.state,uniforms:m,framebuffer:g,extensions:c,timer:v,isBufferArgs:Za},T={primTypes:za,
compareFuncs:Ea,blendFuncs:oa,blendEquations:V,stencilOps:ua,glTypes:Ja,orientationType:db};p.optional(function(){fa.isArrayLike=H});L&&(T.backBuffer=[1029],T.drawBuffer=R(d.maxDrawbuffers,function(a){return 0===a?[0]:R(a,function(a){return 36064+a})}));var W=0;return{next:Ka,current:E,procs:function(){var b=y(),c=b.proc("poll"),f=b.proc("refresh"),e=b.block();c(e);f(e);var h=b.shared,g=h.gl,m=h.next,k=h.current;e(k,".dirty=false;");ea(b,c);ea(b,f,null,!0);var r=a.getExtension("angle_instanced_arrays"),
n;r&&(n=b.link(r));for(var l=0;l<d.maxAttributes;++l){var p=f.def(h.attributes,"[",l,"]"),q=b.cond(p,".buffer");q.then(g,".enableVertexAttribArray(",l,");",g,".bindBuffer(",34962,",",p,".buffer.buffer);",g,".vertexAttribPointer(",l,",",p,".size,",p,".type,",p,".normalized,",p,".stride,",p,".offset);").else(g,".disableVertexAttribArray(",l,");",g,".vertexAttrib4f(",l,",",p,".x,",p,".y,",p,".z,",p,".w);",p,".buffer=null;");f(q);r&&f(n,".vertexAttribDivisorANGLE(",l,",",p,".divisor);")}Object.keys(ra).forEach(function(a){var d=
ra[a],h=e.def(m,".",a),r=b.block();r("if(",h,"){",g,".enable(",d,")}else{",g,".disable(",d,")}",k,".",a,"=",h,";");f(r);c("if(",h,"!==",k,".",a,"){",r,"}")});Object.keys(sa).forEach(function(a){var d=sa[a],h=E[a],r=b.block();r(g,".",d,"(");if(H(h)){d=h.length;var n=b.global.def(m,".",a);var l=b.global.def(k,".",a);r(R(d,function(a){return n+"["+a+"]"}),");",R(d,function(a){return l+"["+a+"]="+n+"["+a+"];"}).join(""));c("if(",R(d,function(a){return n+"["+a+"]!=="+l+"["+a+"]"}).join("||"),"){",r,"}")}else n=
e.def(m,".",a),l=e.def(k,".",a),r(n,");",k,".",a,"=",n,";"),c("if(",n,"!==",l,"){",r,"}");f(r)});return b.compile()}(),compile:function(a,b,c,d,f){var e=y();e.stats=e.link(f);Object.keys(b.static).forEach(function(a){M(e,b,a)});Wb.forEach(function(b){M(e,a,b)});c=S(a,b,c,d,e);N(e,c);F(e,c);ya(e,c);return e.compile()}}}function Cb(a,b){for(var c=0;c<a.length;++c)if(a[c]===b)return c;return-1}var Ia={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,
"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},E=function(a){return Object.prototype.toString.call(a)in Ia},N=function(a,b){for(var c=Object.keys(b),d=0;d<c.length;++d)a[c[d]]=b[c[d]];return a},Db="gl canvas container attributes pixelRatio extensions optionalExtensions profile onDone".split(" "),W={};W[5120]=W[5121]=1;W[5122]=W[5123]=W[36193]=W[33635]=W[32819]=W[32820]=
2;W[5124]=W[5125]=W[5126]=W[34042]=4;var p=N(a,{optional:function(a){a()},raise:e,commandRaise:v,command:function(a,b,d){a||v(b,d||c())},parameter:function(a,b,c){a in b||e("unknown parameter ("+a+")"+g(c)+". possible values: "+Object.keys(b).join())},commandParameter:function(a,b,d,f){a in b||v("unknown parameter ("+a+")"+g(d)+". possible values: "+Object.keys(b).join(),f||c())},constructor:function(a){Object.keys(a).forEach(function(a){0>Db.indexOf(a)&&e('invalid regl constructor argument "'+a+
'". must be one of '+Db)})},type:function(a,b,c){typeof a!==b&&e("invalid parameter type"+g(c)+". expected "+b+", got "+typeof a)},commandType:w,isTypedArray:function(a,b){E(a)||e("invalid parameter type"+g(b)+". must be a typed array")},nni:function(a,b){0<=a&&(a|0)===a||e("invalid parameter type, ("+a+")"+g(b)+". must be a nonnegative integer")},oneOf:l,shaderError:function(c,d,e,h,g){if(!c.getShaderParameter(d,c.COMPILE_STATUS)){d=c.getShaderInfoLog(d);c=h===c.FRAGMENT_SHADER?"fragment":"vertex";
w(e,"string",c+" shader source must be a string",g);var k=b(e,g);e=m(d);f(k,e);Object.keys(k).forEach(function(a){function b(a,b){d.push(a);f.push(b||"")}var c=k[a];if(c.hasErrors){var d=[""],f=[""];b("file number "+a+": "+c.name+"\n","color:red;text-decoration:underline;font-weight:bold");c.lines.forEach(function(a){if(0<a.errors.length){b(u(a.number,4)+"|  ","background-color:yellow; font-weight:bold");b(a.line+"\n","color:red; background-color:yellow; font-weight:bold");var c=0;a.errors.forEach(function(d){d=
d.message;var f=/^\s*\'(.*)\'\s*\:\s*(.*)$/.exec(d);if(f){var e=f[1];d=f[2];switch(e){case "assign":e="="}c=Math.max(a.line.indexOf(e,c),0)}else c=0;b(u("| ",6));b(u("^^^",c+3)+"\n","font-weight:bold");b(u("| ",6));b(d+"\n","font-weight:bold")});b(u("| ",6)+"\n")}else b(u(a.number,4)+"|  "),b(a.line+"\n","color:red")});"undefined"!==typeof document?(f[0]=d.join("%c"),console.log.apply(console,f)):console.log(d.join(""))}});a.raise("Error compiling "+c+" shader, "+k[0].name)}},linkError:function(c,
d,f,e,h){c.getProgramParameter(d,c.LINK_STATUS)||(c=c.getProgramInfoLog(d),f=b(f,h),e='Error linking program with vertex shader, "'+b(e,h)[0].name+'", and fragment shader "'+f[0].name+'"',"undefined"!==typeof document?console.log("%c"+e+"\n%c"+c,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(e+"\n"+c),a.raise(e))},callSite:d,saveCommandRef:h,saveDrawInfo:function(a,b,c,d){function f(a){return a?d.id(a):0}function e(a,b){Object.keys(b).forEach(function(b){a[d.id(b)]=
!0})}h(a);a._fragId=f(a.static.frag);a._vertId=f(a.static.vert);var g=a._uniformSet={};e(g,b.static);e(g,b.dynamic);b=a._attributeSet={};e(b,c.static);e(b,c.dynamic);a._hasCount="count"in a.static||"count"in a.dynamic||"elements"in a.static||"elements"in a.dynamic},framebufferFormat:function(a,b,c){a.texture?l(a.texture._texture.internalformat,b,"unsupported texture format for attachment"):l(a.renderbuffer._renderbuffer.format,c,"unsupported renderbuffer format for attachment")},guessCommand:c,texture2D:function(b,
c,d){var f=c.width,e=c.height,h=c.channels;a(0<f&&f<=d.maxTextureSize&&0<e&&e<=d.maxTextureSize,"invalid texture shape");33071===b.wrapS&&33071===b.wrapT||a(!(f&f-1)&&!!f&&!(e&e-1)&&!!e,"incompatible wrap mode for texture, both width and height must be power of 2");1===c.mipmask?1!==f&&1!==e&&a(9984!==b.minFilter&&9986!==b.minFilter&&9985!==b.minFilter&&9987!==b.minFilter,"min filter requires mipmap"):(a(!(f&f-1)&&!!f&&!(e&e-1)&&!!e,"texture must be a square power of 2 to support mipmapping"),a(c.mipmask===
(f<<1)-1,"missing or incomplete mipmap data"));5126===c.type&&(0>d.extensions.indexOf("oes_texture_float_linear")&&a(9728===b.minFilter&&9728===b.magFilter,"filter not supported, must enable oes_texture_float_linear"),a(!b.genMipmaps,"mipmap generation not supported with float textures"));var g=c.images;for(d=0;16>d;++d)if(g[d]){var m=f>>d,k=e>>d;a(c.mipmask&1<<d,"missing mipmap data");var n=g[d];a(n.width===m&&n.height===k,"invalid shape for mip images");a(n.format===c.format&&n.internalformat===
c.internalformat&&n.type===c.type,"incompatible type for mip image");!n.compressed&&n.data&&(m=Math.ceil(A(n.type,h)*m/n.unpackAlignment)*n.unpackAlignment,a(n.data.byteLength===m*k,"invalid data for image, buffer size is inconsistent with image format"))}else b.genMipmaps||a(0===(c.mipmask&1<<d),"extra mipmap data");c.compressed&&a(!b.genMipmaps,"mipmap generation for compressed images not supported")},textureCube:function(b,c,d,f){var e=b.width,h=b.height,g=b.channels;a(0<e&&e<=f.maxTextureSize&&
0<h&&h<=f.maxTextureSize,"invalid texture shape");a(e===h,"cube map must be square");a(33071===c.wrapS&&33071===c.wrapT,"wrap mode not supported by cube map");for(f=0;f<d.length;++f){var m=d[f];a(m.width===e&&m.height===h,"inconsistent cube map face shape");c.genMipmaps&&(a(!m.compressed,"can not generate mipmap for compressed textures"),a(1===m.mipmask,"can not specify mipmaps and generate mipmaps"));for(var k=m.images,n=0;16>n;++n){var r=k[n];if(r){var l=e>>n,p=h>>n;a(m.mipmask&1<<n,"missing mipmap data");
a(r.width===l&&r.height===p,"invalid shape for mip images");a(r.format===b.format&&r.internalformat===b.internalformat&&r.type===b.type,"incompatible type for mip image");r.compressed||r.data&&a(r.data.byteLength===l*p*Math.max(A(r.type,g),r.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format")}}}}}),Gb=0,la={DynamicVariable:P,define:function(a,b){return new P(a,fa(b+""))},isDynamic:function(a){return"function"===typeof a&&!a._reglType||a instanceof P},unbox:function(a,
b){return"function"===typeof a?new P(0,a):a},accessor:fa},eb={next:"function"===typeof requestAnimationFrame?function(a){return requestAnimationFrame(a)}:function(a){return setTimeout(a,16)},cancel:"function"===typeof cancelAnimationFrame?function(a){return cancelAnimationFrame(a)}:clearTimeout},Eb="undefined"!==typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date},Xb=function(a,b){var c=1;b.ext_texture_filter_anisotropic&&(c=a.getParameter(34047));var d=
1,f=1;b.webgl_draw_buffers&&(d=a.getParameter(34852),f=a.getParameter(36063));return{colorBits:[a.getParameter(3410),a.getParameter(3411),a.getParameter(3412),a.getParameter(3413)],depthBits:a.getParameter(3414),stencilBits:a.getParameter(3415),subpixelBits:a.getParameter(3408),extensions:Object.keys(b).filter(function(a){return!!b[a]}),maxAnisotropic:c,maxDrawbuffers:d,maxColorAttachments:f,pointSizeDims:a.getParameter(33901),lineWidthDims:a.getParameter(33902),maxViewportDims:a.getParameter(3386),
maxCombinedTextureUnits:a.getParameter(35661),maxCubeMapSize:a.getParameter(34076),maxRenderbufferSize:a.getParameter(34024),maxTextureUnits:a.getParameter(34930),maxTextureSize:a.getParameter(3379),maxAttributes:a.getParameter(34921),maxVertexUniforms:a.getParameter(36347),maxVertexTextureUnits:a.getParameter(35660),maxVaryingVectors:a.getParameter(36348),maxFragmentUniforms:a.getParameter(36349),glsl:a.getParameter(35724),renderer:a.getParameter(7937),vendor:a.getParameter(7936),version:a.getParameter(7938)}},
ja=function(a){return Object.keys(a).map(function(b){return a[b]})},lb=R(8,function(){return[]}),G={alloc:Z,free:fb,allocType:function(a,b){switch(a){case 5120:a=new Int8Array(Z(b),0,b);break;case 5121:a=new Uint8Array(Z(b),0,b);break;case 5122:a=new Int16Array(Z(2*b),0,b);break;case 5123:a=new Uint16Array(Z(2*b),0,b);break;case 5124:a=new Int32Array(Z(4*b),0,b);break;case 5125:a=new Uint32Array(Z(4*b),0,b);break;case 5126:a=new Float32Array(Z(4*b),0,b);break;default:return null}return a.length!==
b?a.subarray(0,b):a},freeType:function(a){fb(a.buffer)}},Wa={shape:function(a){for(var b=[];a.length;a=a[0])b.push(a.length);return b},flatten:function(a,b,c,d){var f=1;if(b.length)for(var e=0;e<b.length;++e)f*=b[e];else f=0;c=d||G.allocType(c,f);switch(b.length){case 0:break;case 1:d=b[0];for(b=0;b<d;++b)c[b]=a[b];break;case 2:d=b[0];b=b[1];for(e=f=0;e<d;++e)for(var h=a[e],g=0;g<b;++g)c[f++]=h[g];break;case 3:gb(a,b[0],b[1],b[2],c,0);break;default:hb(a,b,0,c,0)}return c}},Ja={int8:5120,int16:5122,
int32:5124,uint8:5121,uint16:5123,uint32:5125,float:5126,float32:5126},Ta={dynamic:35048,stream:35040,"static":35044},$a=Wa.flatten,mb=Wa.shape,qa=[];qa[5120]=1;qa[5122]=2;qa[5124]=4;qa[5121]=1;qa[5123]=2;qa[5125]=4;qa[5126]=4;var za={points:0,point:0,lines:1,line:1,triangles:4,triangle:4,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},ob=new Float32Array(1),Ib=new Uint32Array(ob.buffer),Mb=[9984,9986,9985,9987],Va=[0,6409,6410,6407,6408],U={};U[6409]=U[6406]=U[6402]=1;U[34041]=
U[6410]=2;U[6407]=U[35904]=3;U[6408]=U[35906]=4;var Jb=Object.keys(Ia).concat(["[object HTMLCanvasElement]","[object CanvasRenderingContext2D]","[object HTMLImageElement]","[object HTMLVideoElement]"]),Ba=[];Ba[5121]=1;Ba[5126]=4;Ba[36193]=2;Ba[5123]=2;Ba[5125]=4;var F=[];F[32854]=2;F[32855]=2;F[36194]=2;F[34041]=4;F[33776]=.5;F[33777]=.5;F[33778]=1;F[33779]=1;F[35986]=.5;F[35987]=1;F[34798]=1;F[35840]=.5;F[35841]=.25;F[35842]=.5;F[35843]=.25;F[36196]=.5;var ha=[];ha[32854]=2;ha[32855]=2;ha[36194]=
2;ha[33189]=2;ha[36168]=1;ha[34041]=4;ha[35907]=4;ha[34836]=16;ha[34842]=8;ha[34843]=6;var Yb=function(a,b,c,d,f){function e(a){this.id=k++;this.refCount=1;this.renderbuffer=a;this.format=32854;this.height=this.width=0;f.profile&&(this.stats={size:0})}function h(b){var c=b.renderbuffer;p(c,"must not double destroy renderbuffer");a.bindRenderbuffer(36161,null);a.deleteRenderbuffer(c);b.renderbuffer=null;b.refCount=0;delete n[b.id];d.renderbufferCount--}var g={rgba4:32854,rgb565:36194,"rgb5 a1":32855,
depth:33189,stencil:36168,"depth stencil":34041};b.ext_srgb&&(g.srgba=35907);b.ext_color_buffer_half_float&&(g.rgba16f=34842,g.rgb16f=34843);b.webgl_color_buffer_float&&(g.rgba32f=34836);var m=[];Object.keys(g).forEach(function(a){m[g[a]]=a});var k=0,n={};e.prototype.decRef=function(){0>=--this.refCount&&h(this)};f.profile&&(d.getTotalRenderbufferSize=function(){var a=0;Object.keys(n).forEach(function(b){a+=n[b].stats.size});return a});return{create:function(b,h){function k(b,d){var e=0,h=0,n=32854;
"object"===typeof b&&b?("shape"in b?(d=b.shape,p(Array.isArray(d)&&2<=d.length,"invalid renderbuffer shape"),e=d[0]|0,h=d[1]|0):("radius"in b&&(e=h=b.radius|0),"width"in b&&(e=b.width|0),"height"in b&&(h=b.height|0)),"format"in b&&(p.parameter(b.format,g,"invalid renderbuffer format"),n=g[b.format])):"number"===typeof b?(e=b|0,h="number"===typeof d?d|0:e):b?p.raise("invalid arguments to renderbuffer constructor"):e=h=1;p(0<e&&0<h&&e<=c.maxRenderbufferSize&&h<=c.maxRenderbufferSize,"invalid renderbuffer size");
if(e!==l.width||h!==l.height||n!==l.format)return k.width=l.width=e,k.height=l.height=h,l.format=n,a.bindRenderbuffer(36161,l.renderbuffer),a.renderbufferStorage(36161,n,e,h),f.profile&&(l.stats.size=ha[l.format]*l.width*l.height),k.format=m[l.format],k}var l=new e(a.createRenderbuffer());n[l.id]=l;d.renderbufferCount++;k(b,h);k.resize=function(b,d){b|=0;d=d|0||b;if(b===l.width&&d===l.height)return k;p(0<b&&0<d&&b<=c.maxRenderbufferSize&&d<=c.maxRenderbufferSize,"invalid renderbuffer size");k.width=
l.width=b;k.height=l.height=d;a.bindRenderbuffer(36161,l.renderbuffer);a.renderbufferStorage(36161,l.format,b,d);f.profile&&(l.stats.size=ha[l.format]*l.width*l.height);return k};k._reglType="renderbuffer";k._renderbuffer=l;f.profile&&(k.stats=l.stats);k.destroy=function(){l.decRef()};return k},clear:function(){ja(n).forEach(h)},restore:function(){ja(n).forEach(function(b){b.renderbuffer=a.createRenderbuffer();a.bindRenderbuffer(36161,b.renderbuffer);a.renderbufferStorage(36161,b.format,b.width,b.height)});
a.bindRenderbuffer(36161,null)}}},Pb=[6408],wb=[];wb[6408]=4;var Ya=[];Ya[5121]=1;Ya[5126]=4;Ya[36193]=2;var Qb=[32854,32855,36194,35907,34842,34843,34836],Ob={36053:"complete",36054:"incomplete attachment",36057:"incomplete dimensions",36055:"incomplete, missing attachment",36061:"unsupported"},Fa=["x","y","z","w"],Wb="blend.func blend.equation stencil.func stencil.opFront stencil.opBack sample.coverage viewport scissor.box polygonOffset.offset".split(" "),oa={0:0,1:1,zero:0,one:1,"src color":768,
"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},zb="constant color, constant alpha;one minus constant color, constant alpha;constant color, one minus constant alpha;one minus constant color, one minus constant alpha;constant alpha, constant color;constant alpha, one minus constant color;one minus constant alpha, constant color;one minus constant alpha, one minus constant color".split(";"),
Ea={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},ua={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},Ab={frag:35632,vert:35633},db={cw:2304,ccw:2305},Bb=new ca(!1,!1,!1,function(){}),Zb=function(a,b){function c(){this.endQueryIndex=this.startQueryIndex=-1;this.sum=0;this.stats=null}function d(a,b,d){var f=
g.pop()||new c;f.startQueryIndex=a;f.endQueryIndex=b;f.sum=0;f.stats=d;m.push(f)}var f=b.ext_disjoint_timer_query;if(!f)return null;var e=[],h=[],g=[],m=[],k=[],n=[];return{beginQuery:function(a){var b=e.pop()||f.createQueryEXT();f.beginQueryEXT(35007,b);h.push(b);d(h.length-1,h.length,a)},endQuery:function(){f.endQueryEXT(35007)},pushScopeStats:d,update:function(){var a;var b=h.length;if(0!==b){n.length=Math.max(n.length,b+1);k.length=Math.max(k.length,b+1);k[0]=0;var c=n[0]=0;for(a=b=0;a<h.length;++a){var d=
h[a];f.getQueryObjectEXT(d,34919)?(c+=f.getQueryObjectEXT(d,34918),e.push(d)):h[b++]=d;k[a+1]=c;n[a+1]=b}h.length=b;for(a=b=0;a<m.length;++a){var c=m[a],l=c.startQueryIndex,d=c.endQueryIndex;c.sum+=k[d]-k[l];l=n[l];d=n[d];d===l?(c.stats.gpuTime+=c.sum/1E6,g.push(c)):(c.startQueryIndex=l,c.endQueryIndex=d,m[b++]=c)}m.length=b}},getNumPendingQueries:function(){return h.length},clear:function(){e.push.apply(e,h);for(var a=0;a<e.length;a++)f.deleteQueryEXT(e[a]);h.length=0;e.length=0},restore:function(){h.length=
0;e.length=0}}};return function(a){function b(){if(0===O.length)z&&z.update(),U=null;else{U=eb.next(b);n();for(var a=O.length-1;0<=a;--a){var c=O[a];c&&c(C,null,0)}r.flush();z&&z.update()}}function c(){!U&&0<O.length&&(U=eb.next(b))}function d(){U&&(eb.cancel(b),U=null)}function f(a){a.preventDefault();u=!0;d();W.forEach(function(a){a()})}function e(a){r.getError();u=!1;t.restore();K.restore();F.restore();G.restore();M.restore();H.restore();z&&z.restore();L.procs.refresh();c();Y.forEach(function(a){a()})}
function h(a){function b(a){var b={},c={};Object.keys(a).forEach(function(d){var f=a[d];la.isDynamic(f)?c[d]=la.unbox(f,d):b[d]=f});return{dynamic:c,static:b}}function c(a){for(;n.length<a;)n.push(null);return n}p(!!a,"invalid args to regl({...})");p.type(a,"object","invalid args to regl({...})");var d=b(a.context||{}),f=b(a.uniforms||{}),e=b(a.attributes||{}),h=b(function(a){function b(a){if(a in c){var b=c[a];delete c[a];Object.keys(b).forEach(function(d){c[a+"."+d]=b[d]})}}var c=N({},a);delete c.uniforms;
delete c.attributes;delete c.context;"stencil"in c&&c.stencil.op&&(c.stencil.opBack=c.stencil.opFront=c.stencil.op,delete c.stencil.op);b("blend");b("depth");b("cull");b("stencil");b("polygonOffset");b("scissor");b("sample");return c}(a));a={gpuTime:0,cpuTime:0,count:0};var d=L.compile(h,e,f,d,a),g=d.draw,m=d.batch,k=d.scope,n=[];return N(function(a,b){var d;u&&p.raise("context lost");if("function"===typeof a)return k.call(this,null,a,0);if("function"===typeof b)if("number"===typeof a)for(d=0;d<a;++d)k.call(this,
null,b,d);else if(Array.isArray(a))for(d=0;d<a.length;++d)k.call(this,a[d],b,d);else return k.call(this,a,b,0);else if("number"===typeof a){if(0<a)return m.call(this,c(a|0),a|0)}else if(Array.isArray(a)){if(a.length)return m.call(this,a,a.length)}else return g.call(this,a)},{stats:a})}function g(a,b){a=0;L.procs.poll();var c=b.color;c&&(r.clearColor(+c[0]||0,+c[1]||0,+c[2]||0,+c[3]||0),a|=16384);"depth"in b&&(r.clearDepth(+b.depth),a|=256);"stencil"in b&&(r.clearStencil(b.stencil|0),a|=1024);p(!!a,
"called regl.clear with no buffer specified");r.clear(a)}function m(a){p.type(a,"function","regl.frame() callback must be a function");O.push(a);c();return{cancel:function(){function b(){var a=Cb(O,b);O[a]=O[O.length-1];--O.length;0>=O.length&&d()}var c=Cb(O,a);p(0<=c,"cannot cancel a frame twice");O[c]=b}}}function k(){var a=fa.viewport,b=fa.scissor_box;a[0]=a[1]=b[0]=b[1]=0;C.viewportWidth=C.framebufferWidth=C.drawingBufferWidth=a[2]=b[2]=r.drawingBufferWidth;C.viewportHeight=C.framebufferHeight=
C.drawingBufferHeight=a[3]=b[3]=r.drawingBufferHeight}function n(){C.tick+=1;C.time=q();k();L.procs.poll()}function l(){k();L.procs.refresh();z&&z.update()}function q(){return(Eb()-A)/1E3}a=Q(a);if(!a)return null;var r=a.gl,v=r.getContextAttributes(),u=r.isContextLost(),t=T(r,a);if(!t)return null;var x=X(),y={bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0},w=t.extensions,z=Zb(r,w),A=Eb(),P=r.drawingBufferWidth,J=r.drawingBufferHeight,
C={tick:0,time:0,viewportWidth:P,viewportHeight:J,framebufferWidth:P,framebufferHeight:J,drawingBufferWidth:P,drawingBufferHeight:J,pixelRatio:a.pixelRatio},E=Xb(r,w),F=Fb(r,y,a),I=Hb(r,w,F,y),P=Rb(r,w,E,F,x),K=Sb(r,x,y,a),G=Kb(r,w,E,function(){L.procs.poll()},C,y,a),M=Yb(r,w,E,y,a),H=Nb(r,w,E,G,M,y),L=Vb(r,x,w,E,F,I,G,H,{},P,K,{elements:null,primitive:4,count:-1,offset:0,instances:-1},C,z,a),x=Tb(r,H,L.procs.poll,C,v,w),fa=L.next,R=r.canvas,O=[],W=[],Y=[],Z=[a.onDestroy],U=null;R&&(R.addEventListener("webglcontextlost",
f,!1),R.addEventListener("webglcontextrestored",e,!1));var ca=H.setFBO=h({framebuffer:la.define.call(null,1,"framebuffer")});l();v=N(h,{clear:function(a){p("object"===typeof a&&a,"regl.clear() takes an object as input");if("framebuffer"in a)if(a.framebuffer&&"framebufferCube"===a.framebuffer_reglType)for(var b=0;6>b;++b)ca(N({framebuffer:a.framebuffer.faces[b]},a),g);else ca(a,g);else g(null,a)},prop:la.define.bind(null,1),context:la.define.bind(null,2),this:la.define.bind(null,3),draw:h({}),buffer:function(a){return F.create(a,
34962,!1,!1)},elements:function(a){return I.create(a,!1)},texture:G.create2D,cube:G.createCube,renderbuffer:M.create,framebuffer:H.create,framebufferCube:H.createCube,attributes:v,frame:m,on:function(a,b){p.type(b,"function","listener callback must be a function");switch(a){case "frame":return m(b);case "lost":var c=W;break;case "restore":c=Y;break;case "destroy":c=Z;break;default:p.raise("invalid event, must be one of frame,lost,restore,destroy")}c.push(b);return{cancel:function(){for(var a=0;a<
c.length;++a)if(c[a]===b){c[a]=c[c.length-1];c.pop();break}}}},limits:E,hasExtension:function(a){return 0<=E.extensions.indexOf(a.toLowerCase())},read:x,destroy:function(){O.length=0;d();R&&(R.removeEventListener("webglcontextlost",f),R.removeEventListener("webglcontextrestored",e));K.clear();H.clear();M.clear();G.clear();I.clear();F.clear();z&&z.clear();Z.forEach(function(a){a()})},_gl:r,_refresh:l,poll:function(){n();z&&z.update()},now:q,stats:y});a.onDone(null,v);return v}})},{}],10:[function(l,
w,t){function k(a,b){for(var c=Array(a.length-1),d=1;d<a.length;++d)for(var f=c[d-1]=Array(a.length-1),e=0,g=0;e<a.length;++e)e!==b&&(f[g++]=a[d][e]);return c}function e(a){if(1===a.length)return a[0];if(2===a.length)return["sum(",a[0],",",a[1],")"].join("");var b=a.length>>1;return["sum(",e(a.slice(0,b)),",",e(a.slice(b)),")"].join("")}function a(b){if(2===b.length)return[["sum(prod(",b[0][0],",",b[1][1],"),prod(-",b[0][1],",",b[1][0],"))"].join("")];for(var c=[],d=0;d<b.length;++d)c.push(["scale(",
e(a(k(b,d))),",",d&1?"-":"",b[0][d],")"].join(""));return c}function g(b){for(var c=[],d=[],g=Array(b),m=0;m<b;++m){g[m]=Array(b);for(var l=0;l<b;++l)g[m][l]=["m",l,"[",b-m-1,"]"].join("")}m=[];for(l=0;l<b;++l)0===(l&1)?c.push.apply(c,a(k(g,l))):d.push.apply(d,a(k(g,l))),m.push("m"+l);c=e(c);d=e(d);b="orientation"+b+"Exact";b=["function ",b,"(",m.join(),"){var p=",c,",n=",d,",d=sub(p,n);return d[d.length-1];};return ",b].join("");return(new Function("sum","prod","scale","sub",b))(n,u,y,q)}function x(a){var c=
b[a.length];c||(c=b[a.length]=g(a.length));return c.apply(void 0,a)}var u=l("two-product"),n=l("robust-sum"),y=l("robust-scale"),q=l("robust-subtract"),c=g(3),d=g(4),b=[function(){return 0},function(){return 0},function(a,b){return b[0]-a[0]},function(a,b,d){var f=(a[1]-d[1])*(b[0]-d[0]),e=(a[0]-d[0])*(b[1]-d[1]),h=f-e;if(0<f){if(0>=e)return h;f+=e}else if(0>f){if(0<=e)return h;f=-(f+e)}else return h;f*=3.3306690738754716E-16;return h>=f||h<=-f?h:c(a,b,d)},function(a,b,c,e){var f=a[0]-e[0],h=b[0]-
e[0],g=c[0]-e[0],m=a[1]-e[1],k=b[1]-e[1],n=c[1]-e[1],l=a[2]-e[2],q=b[2]-e[2],u=c[2]-e[2],v=h*n,t=g*k,g=g*m,n=f*n,f=f*k,m=h*m,h=l*(v-t)+q*(g-n)+u*(f-m),l=7.771561172376103E-16*((Math.abs(v)+Math.abs(t))*Math.abs(l)+(Math.abs(g)+Math.abs(n))*Math.abs(q)+(Math.abs(f)+Math.abs(m))*Math.abs(u));return h>l||-h>l?h:d(a,b,c,e)}];(function(){for(;5>=b.length;)b.push(g(b.length));for(var a=[],c=["slow"],d=0;5>=d;++d)a.push("a"+d),c.push("o"+d);for(var e=["function getOrientation(",a.join(),"){switch(arguments.length){case 0:case 1:return 0;"],
d=2;5>=d;++d)e.push("case ",d,":return o",d,"(",a.slice(0,d).join(),");");e.push("}var s=new Array(arguments.length);for(var i=0;i<arguments.length;++i){s[i]=arguments[i]};return slow(s);}return getOrientation");c.push(e.join(""));a=Function.apply(void 0,c);w.exports=a.apply(void 0,[x].concat(b));for(d=0;5>=d;++d)w.exports[d]=b[d]})()},{"robust-scale":11,"robust-subtract":12,"robust-sum":13,"two-product":15}],11:[function(l,w,t){var k=l("two-product"),e=l("two-sum");w.exports=function(a,g){var l=
a.length;if(1===l)return a=k(a[0],g),a[0]?a:[a[1]];var u=Array(2*l),n=[.1,.1],t=[.1,.1],q=0;k(a[0],g,n);n[0]&&(u[q++]=n[0]);for(var c=1;c<l;++c){k(a[c],g,t);e(n[1],t[0],n);n[0]&&(u[q++]=n[0]);var d=t[1],b=n[1],m=d+b,d=b-(m-d);n[1]=m;d&&(u[q++]=d)}n[1]&&(u[q++]=n[1]);0===q&&(u[q++]=0);u.length=q;return u}},{"two-product":15,"two-sum":16}],12:[function(l,w,t){w.exports=function(k,e){var a=k.length|0,g=e.length|0;if(1===a&&1===g)return k=k[0],a=-e[0],e=k+a,g=e-k,e=(k=k-(e-g)+(a-g))?[k,e]:[e],e;var l=
Array(a+g),u=0,n=0,t=0,q=Math.abs,c=k[n],d=q(c),b=-e[t],m=q(b);if(d<m){var f=c;n+=1;n<a&&(c=k[n],d=q(c))}else f=b,t+=1,t<g&&(b=-e[t],m=q(b));if(n<a&&d<m||t>=g){var h=c;n+=1;n<a&&(c=k[n],d=q(c))}else h=b,t+=1,t<g&&(b=-e[t],m=q(b));var v=h+f;f-=v-h;for(var w=v,A;n<a&&t<g;)d<m?(h=c,n+=1,n<a&&(c=k[n],d=q(c))):(h=b,t+=1,t<g&&(b=-e[t],m=q(b))),v=h+f,h=v-h,(h=f-h)&&(l[u++]=h),h=w+v,A=h-w,f=h-A,v-=A,w-=f,f=w+v,w=h;for(;n<a;)h=c,v=h+f,h=v-h,(h=f-h)&&(l[u++]=h),h=w+v,A=h-w,f=h-A,v-=A,w-=f,f=w+v,w=h,n+=1,n<
a&&(c=k[n]);for(;t<g;)h=b,v=h+f,h=v-h,(h=f-h)&&(l[u++]=h),h=w+v,A=h-w,f=h-A,v-=A,w-=f,f=w+v,w=h,t+=1,t<g&&(b=-e[t]);f&&(l[u++]=f);w&&(l[u++]=w);u||(l[u++]=0);l.length=u;return l}},{}],13:[function(l,w,t){w.exports=function(k,e){var a=k.length|0,g=e.length|0;if(1===a&&1===g)return k=k[0],a=e[0],e=k+a,g=e-k,e=(k=k-(e-g)+(a-g))?[k,e]:[e],e;var l=Array(a+g),t=0,n=0,w=0,q=Math.abs,c=k[n],d=q(c),b=e[w],m=q(b);if(d<m){var f=c;n+=1;n<a&&(c=k[n],d=q(c))}else f=b,w+=1,w<g&&(b=e[w],m=q(b));if(n<a&&d<m||w>=g){var h=
c;n+=1;n<a&&(c=k[n],d=q(c))}else h=b,w+=1,w<g&&(b=e[w],m=q(b));var v=h+f;f-=v-h;for(var z=v,A;n<a&&w<g;)d<m?(h=c,n+=1,n<a&&(c=k[n],d=q(c))):(h=b,w+=1,w<g&&(b=e[w],m=q(b))),v=h+f,h=v-h,(h=f-h)&&(l[t++]=h),h=z+v,A=h-z,f=h-A,v-=A,z-=f,f=z+v,z=h;for(;n<a;)h=c,v=h+f,h=v-h,(h=f-h)&&(l[t++]=h),h=z+v,A=h-z,f=h-A,v-=A,z-=f,f=z+v,z=h,n+=1,n<a&&(c=k[n]);for(;w<g;)h=b,v=h+f,h=v-h,(h=f-h)&&(l[t++]=h),h=z+v,A=h-z,f=h-A,v-=A,z-=f,f=z+v,z=h,w+=1,w<g&&(b=e[w]);f&&(l[t++]=f);z&&(l[t++]=z);t||(l[t++]=0);l.length=t;
return l}},{}],14:[function(l,w,t){function k(a,d){var b=a.length,c=a.length-d.length,f=Math.min;if(c)return c;switch(b){case 0:return 0;case 1:return a[0]-d[0];case 2:return(b=a[0]+a[1]-d[0]-d[1])?b:f(a[0],a[1])-f(d[0],d[1]);case 3:var c=a[0]+a[1],e=d[0]+d[1];if(b=c+a[2]-(e+d[2]))return b;var g=f(a[0],a[1]),k=f(d[0],d[1]);return(b=f(g,a[2])-f(k,d[2]))?b:f(g+a[2],c)-f(k+d[2],e);default:a=a.slice(0);a.sort();d=d.slice(0);d.sort();for(f=0;f<b;++f)if(c=a[f]-d[f])return c;return 0}}function e(a,d){return k(a[0],
d[0])}function a(a,d){if(d){for(var b=a.length,c=Array(b),f=0;f<b;++f)c[f]=[a[f],d[f]];c.sort(e);for(f=0;f<b;++f)a[f]=c[f][0],d[f]=c[f][1]}else a.sort(k);return a}function g(a){if(0===a.length)return[];for(var c=1,b=a.length,e=1;e<b;++e){var f=a[e];k(f,a[e-1])&&(e===c?c++:a[c++]=f)}a.length=c;return a}function x(a,d){for(var b=0,c=a.length-1,f=-1;b<=c;){var e=b+c>>1,g=k(a[e],d);0>=g?(0===g&&(f=e),b=e+1):0<g&&(c=e-1)}return f}function u(a,d){for(var b=Array(a.length),c=0,f=b.length;c<f;++c)b[c]=[];
for(var f=[],c=0,e=d.length;c<e;++c)for(var g=d[c],l=g.length,n=1,q=1<<l;n<q;++n){f.length=y.popCount(n);for(var t=0,u=0;u<l;++u)n&1<<u&&(f[t++]=g[u]);t=x(a,f);if(!(0>t))for(;!(b[t++].push(c),t>=a.length||0!==k(a[t],f)););}return b}function n(c,d){if(0>d)return[];for(var b=[],e=(1<<d+1)-1,f=0;f<c.length;++f)for(var h=c[f],g=e;g<1<<h.length;g=y.nextCombination(g)){for(var k=Array(d+1),n=0,l=0;l<h.length;++l)g&1<<l&&(k[n++]=h[l]);b.push(k)}return a(b)}"use restrict";var y=l("bit-twiddle"),q=l("union-find");
t.dimension=function(a){for(var c=0,b=Math.max,e=0,f=a.length;e<f;++e)c=b(c,a[e].length);return c-1};t.countVertices=function(a){for(var c=-1,b=Math.max,e=0,f=a.length;e<f;++e)for(var h=a[e],g=0,k=h.length;g<k;++g)c=b(c,h[g]);return c+1};t.cloneCells=function(a){for(var c=Array(a.length),b=0,e=a.length;b<e;++b)c[b]=a[b].slice(0);return c};t.compareCells=k;t.normalize=a;t.unique=g;t.findCell=x;t.incidence=u;t.dual=function(a,d){if(!d)return u(g(n(a,0)),a,0);for(var b=Array(d),c=0;c<d;++c)b[c]=[];c=
0;for(d=a.length;c<d;++c)for(var f=a[c],e=0,k=f.length;e<k;++e)b[f[e]].push(c);return b};t.explode=function(c){for(var d=[],b=0,e=c.length;b<e;++b)for(var f=c[b],g=f.length|0,k=1,l=1<<g;k<l;++k){for(var n=[],q=0;q<g;++q)k>>>q&1&&n.push(f[q]);d.push(n)}return a(d)};t.skeleton=n;t.boundary=function(c){for(var d=[],b=0,e=c.length;b<e;++b)for(var f=c[b],g=0,k=f.length;g<k;++g){for(var l=Array(f.length-1),n=0,q=0;n<k;++n)n!==g&&(l[q++]=f[n]);d.push(l)}return a(d)};t.connectedComponents=function(c,d){if(d){d=
new q(d);for(var b=0;b<c.length;++b)for(var e=c[b],f=0;f<e.length;++f)for(var h=f+1;h<e.length;++h)d.link(e[f],e[h]);e=[];f=d.ranks;for(b=0;b<f.length;++b)f[b]=-1;for(b=0;b<c.length;++b)h=d.find(c[b][0]),0>f[h]?(f[h]=e.length,e.push([c[b].slice(0)])):e[f[h]].push(c[b].slice(0));return e}d=g(a(n(c,0)));b=new q(d.length);for(e=0;e<c.length;++e)for(f=c[e],h=0;h<f.length;++h)for(var k=x(d,[f[h]]),l=h+1;l<f.length;++l)b.link(k,x(d,[f[l]]));f=[];h=b.ranks;for(e=0;e<h.length;++e)h[e]=-1;for(e=0;e<c.length;++e)k=
b.find(x(d,[c[e][0]])),0>h[k]?(h[k]=f.length,f.push([c[e].slice(0)])):f[h[k]].push(c[e].slice(0));return f}},{"bit-twiddle":1,"union-find":17}],15:[function(l,w,t){w.exports=function(e,a,g){var l=e*a,t=k*e,t=t-(t-e);e-=t;var n=k*a,n=n-(n-a);a-=n;a=e*a-(l-t*n-e*n-t*a);return g?(g[0]=a,g[1]=l,g):[a,l]};var k=+(Math.pow(2,27)+1)},{}],16:[function(l,w,t){w.exports=function(k,e,a){var g=k+e,l=g-k;e-=l;k-=g-l;return a?(a[0]=k+e,a[1]=g,a):[k+e,g]}},{}],17:[function(l,w,t){function k(e){this.roots=Array(e);
this.ranks=Array(e);for(var a=0;a<e;++a)this.roots[a]=a,this.ranks[a]=0}"use restrict";w.exports=k;l=k.prototype;Object.defineProperty(l,"length",{get:function(){return this.roots.length}});l.makeSet=function(){var e=this.roots.length;this.roots.push(e);this.ranks.push(0);return e};l.find=function(e){for(var a=e,g=this.roots;g[e]!==e;)e=g[e];for(;g[a]!==e;){var k=g[a];g[a]=e;a=k}return e};l.link=function(e,a){e=this.find(e);a=this.find(a);if(e!==a){var g=this.ranks,k=this.roots,l=g[e],n=g[a];l<n?
k[e]=a:n<l?k[a]=e:(k[a]=e,++g[e])}}},{}],18:[function(l,w,t){w.exports=function(k,e,a){if(0===k.length)return k;if(e){a||k.sort(e);a=1;for(var g=k.length,l=k[0],t,n=1;n<g;++n)t=l,l=k[n],e(l,t)&&(n===a?a++:k[a++]=l);k.length=a;return k}a||k.sort();e=1;a=k.length;g=k[0];for(t=1;t<a;++t)l=g,g=k[t],g!==l&&(t===e?e++:k[e++]=g);k.length=e;return k}},{}],19:[function(l,w,t){Object.defineProperty(t,"__esModule",{value:!0});var k=function(){function a(a,e){for(var g=0;g<e.length;g++){var k=e[g];k.enumerable=
k.enumerable||!1;k.configurable=!0;"value"in k&&(k.writable=!0);Object.defineProperty(a,k.key,k)}}return function(e,k,l){k&&a(e.prototype,k);l&&a(e,l);return e}}(),e=function(a,e,k){return k<=a?a:k>=e?e:k};l=function(){function a(){if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");this.canvas=document.createElement("canvas");this.ctx=this.canvas.getContext("2d");this.height=this.width=0}k(a,[{key:"load",value:function(a,e,k){e=Math.min(e/a.width,e/a.height);this.width=
Math.round(a.width*e);this.height=Math.round(a.height*e);this.canvas.width=this.width;this.canvas.height=this.height;this.ctx.drawImage(a,0,0,this.width,this.height);a=this.imageData=this.ctx.getImageData(0,0,this.width,this.height);e=new Float32Array(a.data.length/4);for(var g=0;g<a.data.length/4;g++)e[g]=(.299*a.data[4*g+0]+.587*a.data[4*g+1]+.114*a.data[4*g+2])/255;a=this.luminance=e;e=this.width;var g=this.height,l=new Float32Array(a.length);var q=~~k;k=[];for(var c=-q;c<q+1;c++)for(var d=-q;d<
q+1;d++)Math.round(Math.sqrt(d*d+c*c))<=q&&k.push({x:d,y:c});q=1E6;var c=-1E6,b;for(b in l){var d=b%e,m=~~(b/g),f=0,h=0,t=!0,u=!1,w=void 0;try{for(var x=k[Symbol.iterator](),J;!(t=(J=x.next()).done);t=!0){var fa=J.value,X=d+fa.x,Ga=m+fa.y;0>X||0>Ga||X>=e||Ga>=g||(f+=a[X+Ga*e],h++)}}catch(Z){u=!0,w=Z}finally{try{!t&&x.return&&x.return()}finally{if(u)throw w;}}var t=f/h,h=f=0,u=!0,w=!1,L=void 0;try{for(var M=k[Symbol.iterator](),C;!(u=(C=M.next()).done);u=!0){var Q=C.value,T=d+Q.x,K=m+Q.y;if(!(0>T||
0>K||T>=e||K>=g)){var R=a[T+K*e],f=f+(R-t)*(R-t);h++}}}catch(Z){w=!0,L=Z}finally{try{!u&&M.return&&M.return()}finally{if(w)throw L;}}d=Math.sqrt(f/h);l[b]=d;d<q&&(q=d);d>c&&(c=d)}for(var Ha in l)l[Ha]=(l[Ha]-q)/(c-q);this.sDev=l}},{key:"getRGBA",value:function(a,k){a=e(0,this.imageData.width,~~a);k=e(0,this.imageData.height,~~k);var g=this.imageData.width;return[this.imageData.data[4*(a+k*g)+0]/255,this.imageData.data[4*(a+k*g)+1]/255,this.imageData.data[4*(a+k*g)+2]/255,this.imageData.data[4*(a+
k*g)+3]/255]}},{key:"getLuminance",value:function(a,k){a=e(0,this.width,~~a);k=e(0,this.height,~~k);return this.luminance[a+k*this.imageData.width]}},{key:"getSDev",value:function(a,k){a=e(0,this.width,~~a);k=e(0,this.height,~~k);return this.sDev[a+k*this.imageData.width]}}]);return a}();t.default=l},{}],20:[function(l,w,t){function k(a){return a&&a.__esModule?a:{default:a}}w=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=
a[c]);b.default=a;return b}(l("d3-force"));t=l("delaunay-triangulate");var e=k(t);t=l("./colorpicker");t=k(t);l=l("./renderer");var a={},g=new (k(l).default)(a),x=new t.default,u=new Image,n=1,y=function(a,c,d){var b=Math.cos(d);d=Math.sin(d);return[b*a-d*c,d*a+b*c]},q=[],c=w.forceSimulation(q).velocityDecay(.2).force("collide",w.forceCollide().radius(function(a,c){var b=a.x*n+x.width/2,d=a.y*-n+x.height/2;c=1-x.getSDev(b,d);a.color=x.getRGBA(b,d);b=y(a.x,a.y,-.001);a.vx+=.999*b[0]-a.x;a.vy+=.999*
b[1]-a.y;a.r=.01+.3*Math.pow(c,6);return a.r}).strength(.7).iterations(2)),d=function(){for(var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,c=0;c<a;c++){var d=y(1*Math.random(),0,Math.random()*Math.PI*2);q.push({x:d[0],y:d[1]})}};u.onload=function(b){x.load(u,256,9);n=.5*Math.min(x.width,x.height);d(100);g.start(function(){1500>q.length?d(1):q.shift();c.nodes(q);c.tick();a.points=q.map(function(a){return[a.x,a.y]});a.colors=q.map(function(a){return a.color});a.triangles=(0,e.default)(a.points);
a.lines=[];for(var b in a.triangles)a.lines.push([a.triangles[b][0],a.triangles[b][1]]),a.lines.push([a.triangles[b][1],a.triangles[b][2]]),a.lines.push([a.triangles[b][2],a.triangles[b][0]])})};u.src="img/mask.jpg"},{"./colorpicker":19,"./renderer":21,"d3-force":4,"delaunay-triangulate":7}],21:[function(l,w,t){Object.defineProperty(t,"__esModule",{value:!0});var k=function(){function a(a,e){for(var g=0;g<e.length;g++){var c=e[g];c.enumerable=c.enumerable||!1;c.configurable=!0;"value"in c&&(c.writable=
!0);Object.defineProperty(a,c.key,c)}}return function(e,g,k){g&&a(e.prototype,g);k&&a(e,k);return e}}();l=(l=l("regl"))&&l.__esModule?l:{default:l};var e=(0,l.default)(),a=e({frag:"\n    precision mediump float;\n    uniform vec4 color;\n\n    void main() {\n      float len = length(gl_PointCoord.xy - 0.5) * 2.0;\n      if (len > 1.0) {\n        discard;\n      }\n      gl_FragColor = vec4(color.rgb, 1.0 - len);\n    }",vert:"\n    precision mediump float;\n    attribute vec2 position;\n    uniform vec2 aspect;\n    uniform float zoom;\n\n    void main() {\n      gl_PointSize = 3.0;\n      gl_Position = vec4(position * aspect * zoom, 0.0, 1.0);\n    }",
blend:{enable:!0,func:{srcRGB:"src alpha",srcAlpha:1,dstRGB:"one",dstAlpha:1},equation:{rgb:"add",alpha:"add"}},uniforms:{aspect:e.prop("aspect"),zoom:e.prop("zoom"),color:e.prop("color")},attributes:{position:e.prop("position")},count:e.prop("count"),primitive:"points"}),g=e({frag:"\n    precision mediump float;\n    varying lowp vec4 vColor;\n    void main() {\n      gl_FragColor = vec4(vColor.rgb, 0.5);\n    }",vert:"\n    precision mediump float;\n    attribute vec2 position;\n    attribute vec4 color;\n    uniform vec2 aspect;\n    uniform float zoom;\n    varying lowp vec4 vColor;\n\n    void main() {\n      gl_Position = vec4(position * aspect * zoom, 0.5, 1.0);\n      vColor = color;\n    }",
blend:{enable:!0,func:{srcRGB:"src alpha",srcAlpha:1,dstRGB:"one",dstAlpha:1},equation:{rgb:"add",alpha:"add"}},uniforms:{aspect:e.prop("aspect"),zoom:e.prop("zoom")},attributes:{position:e.prop("position"),color:e.prop("color")},elements:e.prop("elements"),primitive:"line",lineWidth:1}),x=e({frag:"\n    precision mediump float;\n    varying lowp vec4 vColor;\n    void main() {\n      gl_FragColor = vec4(vColor.rgb, 0.8);\n    }",vert:"\n    precision mediump float;\n    attribute vec2 position;\n    attribute vec4 color;\n    uniform vec2 aspect;\n    uniform float zoom;\n    varying lowp vec4 vColor;\n\n    void main() {\n      gl_Position = vec4(position * aspect * zoom, 0.6, 1.0);\n      vColor = color;\n    }",
blend:{enable:!0,func:{srcRGB:"src alpha",srcAlpha:1,dstRGB:"one",dstAlpha:1},equation:{rgb:"add",alpha:"add"}},uniforms:{aspect:e.prop("aspect"),zoom:e.prop("zoom")},attributes:{position:e.prop("position"),color:e.prop("color")},elements:e.prop("elements"),primitive:"triangle"});l=function(){function l(a){if(!(this instanceof l))throw new TypeError("Cannot call a class as a function");this.model=a}k(l,[{key:"start",value:function(a){var g=this;e.frame(function(e){a();g.render(e)})}},{key:"render",
value:function(k){var l=k.viewportWidth;var n=k.viewportHeight;l=l>n?[n/l,1]:[1,l/n];k=1+.5*Math.sin(.1*k.time);e.clear({color:[0,0,.2,1],depth:1});x({aspect:l,zoom:k,position:this.model.points,color:this.model.colors,elements:this.model.triangles});g({aspect:l,zoom:k,position:this.model.points,color:this.model.colors,elements:this.model.lines});a({aspect:l,zoom:k,position:this.model.points,color:[1,1,1,1],count:this.model.points.length})}}]);return l}();t.default=l},{regl:9}]},{},[20]);
